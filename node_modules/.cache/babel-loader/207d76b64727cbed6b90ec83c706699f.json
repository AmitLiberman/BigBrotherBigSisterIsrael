{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import Video from\"../partial/video/Video\";import VidButtons from\"../partial/video/VidButtons\";import Chat from\"../partial/chat/Chat\";import\"./VideoPage.css\";import firebase from\"../../../config/Firebase\";import Credit from\"../partial/credit/Credit\";var configuration={// determine internet configuation\niceServers:[{urls:['stun:stun1.l.google.com:19302','stun:stun2.l.google.com:19302']}],iceCandidatePoolSize:10};var constraints={audio:true,video:{width:{ideal:1920},height:{ideal:1080}}};var localVideo=React.createRef();var remoteVideo=React.createRef();var VideoPage=/*#__PURE__*/function(_Component){_inherits(VideoPage,_Component);var _super=_createSuper(VideoPage);function VideoPage(props){var _this;_classCallCheck(this,VideoPage);_this=_super.call(this,props);_this.startVideoDirectly=function(){// auto video start\n_this.startVideo();var checkIfStartedStream=setInterval(function(){if(_this.state.localStream&&_this.state.remoteStream){if(_this.props.hostVid)_this.createRoom();else _this.joinRoomById(_this.props.room_id);clearInterval(checkIfStartedStream);}},200);};_this.startVideo=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:navigator.mediaDevices.getUserMedia(constraints).then(function(stream){console.log(\"Chrome has received your local stream successfully\\nUsing video device: \"+stream.getVideoTracks()[0].label+\"\\nUsing audio device: \"+stream.getAudioTracks()[0].label);_this.setState({remoteStream:new MediaStream()},function(){remoteVideo.current.srcObject=_this.state.remoteStream;});_this.setState({localStream:stream},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:localVideo.current.srcObject=_this.state.localStream;_this.setState({isStarted:true,hang_btn_disable:false,start_btn_disable:true});_this.props.modifyVideoStream();// modifing app about a new video stream\ncase 3:case\"end\":return _context.stop();}}},_callee);})));}).catch(function(e){alert(e.name);_this.props.modifyVideoNotAllowed();});case 1:case\"end\":return _context2.stop();}}},_callee2);}));_this.createRoom=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(_this.state.isStarted){_context5.next=3;break;}alert(\"אנא לחץ על כפתור 'התחל שיחת וידאו'\");return _context5.abrupt(\"return\");case 3:_this.setState({create_btn_disable:true});_this.setState({localPeer:new RTCPeerConnection(configuration)},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var offer,roomOffer,roomRef,firstSnap;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// create local peer\nconsole.log(\"Created local peer\");_this.getMediaTracks();_this.getRemoteMediaTracks();_this.handleDataChannel('first_channel');_context4.next=6;return _this.state.localPeer.createOffer();case 6:offer=_context4.sent;// creating offer request\nroomOffer={offer:{type:offer.type,sdp:offer.sdp}};_context4.next=10;return _this.usersRef.doc(_this.props.linkId).collection('Rooms').add(roomOffer);case 10:roomRef=_context4.sent;_this.connectionHandler(roomRef,'first_participant','second_participant');// handle internet connection (based on ICE protocol)\n_context4.prev=12;_context4.next=15;return _this.state.localPeer.setLocalDescription(offer);case 15:_context4.next=20;break;case 17:_context4.prev=17;_context4.t0=_context4[\"catch\"](12);console.log(_context4.t0.name);case 20:firstSnap=roomRef.onSnapshot(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(snapshot){var data,answer;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// waiting for an answer\ndata=snapshot.data();_context3.prev=1;if(!(!_this.state.localPeer.currentRemoteDescription&&typeof data.answer!=='undefined')){_context3.next=9;break;}console.log(\"Got update room is \".concat(snapshot.id));console.log(\"Set remote description: \".concat(data.answer));answer=new RTCSessionDescription(data.answer);console.log(answer);_context3.next=9;return _this.state.localPeer.setRemoteDescription(answer);case 9:_context3.next=14;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](1);console.log(_context3.t0.name);case 14:case\"end\":return _context3.stop();}}},_callee3,null,[[1,11]]);}));return function(_x){return _ref5.apply(this,arguments);};}());_this.setState({firstSnapShot:firstSnap});case 22:case\"end\":return _context4.stop();}}},_callee4,null,[[12,17]]);})));case 5:case\"end\":return _context5.stop();}}},_callee5);}));_this.joinRoom=function(guestId){// For joining a room with entering friend's room ID as an input (optional) \nif(!_this.state.isStarted){alert(\"אנא לחץ על כפתור 'התחל שיחה'\");return;}if(guestId===\"\"){alert(\"אנא הכנס את מספר החדר של החניך/חונך\");return;}_this.joinRoomById(guestId);};_this.joinRoomById=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(roomIdOfGuest){var roomRef,roomSnap;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_this.setState({create_btn_disable:true,join_btn_disable:true});console.log(\"You want to join room \".concat(roomIdOfGuest));if(!(roomIdOfGuest===\"\")){_context7.next=6;break;}alert(_this.props.linkedName+\" ביטל את השיחה\");document.location.reload(true);return _context7.abrupt(\"return\");case 6:roomRef=_this.usersRef.doc(_this.props.myLinkId).collection('Rooms').doc(\"\".concat(roomIdOfGuest));_context7.next=9;return roomRef.get();case 9:roomSnap=_context7.sent;console.log(\"Room existance in DB: \".concat(roomSnap.exists));if(roomSnap.exists){_context7.next=15;break;}alert(\"החדר לא קיים במערכת. נסה שוב.\");_this.setState({create_btn_disable:false,join_btn_disable:false});return _context7.abrupt(\"return\");case 15:_this.setState({readyToJoin:true,roomId:\"מספר החדר שלך הינו: \"+roomRef.id});console.log(\"Creating peer connection with the configuration: \".concat(configuration));_this.setState({localPeer:new RTCPeerConnection(configuration)},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var offer,answer,roomAnswer;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:console.log(\"Created local peer\");_this.getMediaTracks();_this.getRemoteMediaTracks();_this.handleDataChannel('second_channel');_this.connectionHandler(roomRef,'second_participant','first_participant');// handle internet connection (based on ICE protocol)\noffer=roomSnap.data().offer;console.log(\"created offer\");_context6.next=9;return _this.state.localPeer.setRemoteDescription(offer);case 9:_context6.next=11;return _this.state.localPeer.createAnswer();case 11:answer=_context6.sent;_context6.next=14;return _this.state.localPeer.setLocalDescription(answer);case 14:roomAnswer={answer:{type:answer.type,sdp:answer.sdp}};_context6.next=17;return roomRef.update(roomAnswer);case 17:case\"end\":return _context6.stop();}}},_callee6);})));case 18:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x2){return _ref6.apply(this,arguments);};}();_this.hangUp=function(val){var willReload=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var isConfirmed;if(!val)isConfirmed=true;else isConfirmed=window.confirm(\"האם אתה בטוח שברצונך לסיים את השיחה?\");if(isConfirmed){_this.setState({isFinished:true});if(_this.state.localChannel&&_this.state.localChannel.readyState==='open'&&_this.state.remoteChannel&&(val||!willReload))_this.state.localChannel.send(JSON.stringify({finish:true}));if(_this.state.firstSnapShot!==null)_this.state.firstSnapShot();if(_this.state.secondSnapShot!==null)_this.state.secondSnapShot();clearInterval(_this.state.intervalFunc);_this.state.localStream.getTracks().forEach(function(track){return track.stop();});console.log(\"Closed local tracks\");if(_this.state.remoteStream){_this.state.remoteStream.getTracks().forEach(function(track){return track.stop();});console.log(\"Closed remote tracks\");}if(val&&willReload&&_this.state.isConnected)alert(\"סיימת את השיחה. זמן השיחה: \"+_this.state.timer[0]+\":\"+_this.state.timer[1]+\"\"+_this.state.timer[2]+\":\"+_this.state.timer[3]+\"\"+_this.state.timer[4]);else if(!val&&willReload&&_this.state.isConnected)alert(\"זמן השיחה: \"+_this.state.timer[0]+\":\"+_this.state.timer[1]+\"\"+_this.state.timer[2]+\":\"+_this.state.timer[3]+\"\"+_this.state.timer[4]);if(_this.state.localPeer!==null){_this.state.localPeer.close();console.log(\"Closed local peer\");}_this.setState({localPeer:null});if(willReload){setTimeout(function(){document.location.reload(true);},500);}else _this.props.removeDocs();}};_this.connectionHandler=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(roomRef,localName,remoteName){var candidateCol,secondSnap;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:// handle internet connection\ncandidateCol=roomRef.collection(localName);try{_this.state.localPeer.addEventListener('icecandidate',function(event){if(event.candidate){var jsonData=event.candidate.toJSON();candidateCol.add(jsonData);}});}catch(e){console.log(e.name);}try{_this.state.localPeer.onconnectionstatechange=_this.onIceChanged;}catch(e){console.log(e.name);}secondSnap=roomRef.collection(remoteName).onSnapshot(function(snapshot){snapshot.docChanges().forEach(function(change){if(change.type===\"added\"||change.doc.data()){var candidate=new RTCIceCandidate(change.doc.data());_this.state.localPeer.addIceCandidate(candidate);console.log(\"candidate success\");}});});_this.setState({secondSnapShot:secondSnap});case 5:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x3,_x4,_x5){return _ref8.apply(this,arguments);};}();_this.onIceChanged=function(e){// internet connection change event\nvar currStat=e.target;console.log(\"ICE connection state changed: \".concat(currStat.iceConnectionState));if(currStat.iceConnectionState===\"connected\"&&!_this.state.isConnected)// first time connection\n_this.onCandidateConnected();else if(currStat.iceConnectionState===\"connected\"&&_this.state.isConnected)// reconnection\n_this.onReconnection();else if(currStat.iceConnectionState===\"disconnected\"&&_this.state.isConnected)// disconnecction after connection\n_this.onCandidateDisconnected();else if((currStat.iceConnectionState===\"disconnected\"||currStat.iceConnectionState===\"checking\")&&!_this.state.isConnected)// disconnection before connection\n_this.onCandidateChecking();};_this.mateDisconnected=function(){clearInterval(_this.state.intervalFunc);alert(_this.props.linkedName+\" סיים את השיחה.\");_this.hangUp(false);};_this.onCandidateConnected=function(){console.log(\"תהליך ההתחברות הסתיים בהצלחה.\");_this.setState({isConnected:true,muteVis:\"visible\",vidVis:\"visible\",create_btn_disable:true,join_btn_disable:true,send_btn_disable:false,input_disable:false,fullScreen:false});if(_this.state.intervalFunc===null)_this.setState({intervalFunc:setInterval(_this.intervalFunc,1000)});};_this.unavailableConnection=function(){clearTimeout(_this.setState.timeoutDisconnected);var iceConnectionState=_this.state.localPeer.iceConnectionState;if(iceConnectionState===\"disconnected\"||iceConnectionState===\"checking\"){clearInterval(_this.state.intervalFunc);alert(_this.props.linkedName+\" חווה בעיית אינטרנט. נסו שוב מאוחר יותר.\");_this.hangUp(false);}};_this.onReconnection=function(){_this.setState({disconFlag:false});};_this.onCandidateDisconnected=function(){if(!_this.state.disconFlag){_this.setState({timeoutDisconnected:setTimeout(_this.unavailableConnection,15000),disconFlag:true});}};_this.checkCon=function(){clearTimeout(_this.state.timeoutChecking);if(!_this.state.isConnected){clearInterval(_this.state.intervalFunc);alert(\"תהליך ההתחברות נכשל. אנא נסה שוב בעוד מספר דקות.\");_this.hangUp(false);}else _this.setState({checkFlag:false});};_this.onCandidateChecking=function(){if(!_this.state.checkFlag)_this.setState({timeoutChecking:setTimeout(_this.checkCon,10000),checkFlag:true,readyToJoin:true});};_this.intervalFunc=function(){if(_this.state.timer[4]!==9)_this.setState({timer:[_this.state.timer[0],_this.state.timer[1],_this.state.timer[2],_this.state.timer[3],_this.state.timer[4]+1]});else if(_this.state.timer[4]===9&&_this.state.timer[3]!==5)_this.setState({timer:[_this.state.timer[0],_this.state.timer[1],_this.state.timer[2],_this.state.timer[3]+1,0]});else if(_this.state.timer[4]===9&&_this.state.timer[3]===5&&_this.state.timer[2]!==9)_this.setState({timer:[_this.state.timer[0],_this.state.timer[1],_this.state.timer[2]+1,0,0]});else if(_this.state.timer[4]===9&&_this.state.timer[3]===5&&_this.state.timer[2]===9&&_this.state.timer[1]!==5)_this.setState({timer:[_this.state.timer[0],_this.state.timer[1]+1,0,0,0]});else _this.setState({timer:[_this.state.timer[0]+1,0,0,0,0]});};_this.mute=function(){if(_this.state.localStream.getAudioTracks()[0].enabled){_this.setState({mute_icon:\"blue\"});_this.state.localChannel.send(JSON.stringify({mute:true}));}else{_this.setState({mute_icon:\"black\"});_this.state.localChannel.send(JSON.stringify({mute:false}));}_this.state.localStream.getAudioTracks()[0].enabled=!_this.state.localStream.getAudioTracks()[0].enabled;};_this.stopVideo=function(){if(_this.state.localStream.getVideoTracks()[0].enabled){_this.setState({video_icon:\"blue\"});_this.state.localChannel.send(JSON.stringify({video:true}));}else{_this.setState({video_icon:\"black\"});_this.state.localChannel.send(JSON.stringify({video:false}));}_this.state.localStream.getVideoTracks()[0].enabled=!_this.state.localStream.getVideoTracks()[0].enabled;};_this.handleDataChannel=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(dataChannelName){var dataPar;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0://creating data channel\ndataPar={ordered:true};_this.setState({localChannel:_this.state.localPeer.createDataChannel(dataChannelName,dataPar)},function(){_this.state.localChannel.binaryType='arraybuffer';_this.state.localChannel.onopen=_this.openDataChannel;_this.state.localChannel.onclose=_this.closedDataChannel;_this.state.localPeer.ondatachannel=_this.remoteOpenDataChannel;});case 2:case\"end\":return _context9.stop();}}},_callee9);}));return function(_x6){return _ref9.apply(this,arguments);};}();_this.getMediaTracks=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:if(typeof _this.state.localStream!=='undefined'){_this.state.localStream.getTracks().forEach(function(track){return _this.state.localPeer.addTrack(track,_this.state.localStream);});console.log(\"Local stream has added to peer\");}case 1:case\"end\":return _context10.stop();}}},_callee10);}));_this.getRemoteMediaTracks=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_this.state.localPeer.addEventListener('track',function(event){console.log(\"Got remote track: \".concat(event.streams[0]));event.streams[0].getTracks().forEach(function(track){console.log(\"Added track to the remote stream: \".concat(track));_this.state.remoteStream.addTrack(track);});});case 1:case\"end\":return _context11.stop();}}},_callee11);}));_this.openDataChannel=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(){return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:console.log(\"Local channel has opened\");case 1:case\"end\":return _context12.stop();}}},_callee12);}));_this.closedDataChannel=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(){return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:console.log(\"Local channel has closed\");if(_this.state.isConnected&&!_this.state.isFinished)alert(\"סיימת את השיחה. זמן השיחה: \"+_this.state.timer[0]+\":\"+_this.state.timer[1]+\"\"+_this.state.timer[2]+\":\"+_this.state.timer[3]+\"\"+_this.state.timer[4]);case 2:case\"end\":return _context13.stop();}}},_callee13);}));_this.remoteOpenDataChannel=/*#__PURE__*/function(){var _ref14=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee14(event){return _regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:event.preventDefault();_this.setState({remoteChannel:event.channel},function(){_this.state.remoteChannel.onmessage=_this.getMessage;});case 2:case\"end\":return _context14.stop();}}},_callee14);}));return function(_x7){return _ref14.apply(this,arguments);};}();_this.getMessage=/*#__PURE__*/function(){var _ref15=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee15(event){var newMessage;return _regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:event.preventDefault();newMessage=JSON.parse(event.data);if(typeof newMessage==='string')_this.setState({outMes:{mes:newMessage}});else if(newMessage.finish===true)_this.setState({isFinished:true},_this.mateDisconnected());else if(newMessage.mute===true)_this.setState({rem_mute_icon:\"blue\"});else if(newMessage.mute===false)_this.setState({rem_mute_icon:\"black\"});else if(newMessage.video===true)_this.setState({rem_video_icon:\"blue\"});else if(newMessage.video===false)_this.setState({rem_video_icon:\"black\"});case 3:case\"end\":return _context15.stop();}}},_callee15);}));return function(_x8){return _ref15.apply(this,arguments);};}();_this.sendMessage=/*#__PURE__*/function(){var _ref16=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee16(message){return _regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:_this.state.localChannel.send(JSON.stringify(message));console.log(\"The message was sent: \"+message);case 2:case\"end\":return _context16.stop();}}},_callee16);}));return function(_x9){return _ref16.apply(this,arguments);};}();_this.state={localStream:null,remoteStream:null,localPeer:null,roomId:\"\",localChannel:null,remoteChannel:null,start_btn_disable:false,hang_btn_disable:true,create_btn_disable:false,join_btn_disable:false,send_btn_disable:true,input_disable:true,fullScreen:true,muteVis:\"hidden\",vidVis:\"hidden\",isStarted:false,isConnected:false,isFinished:false,readyToJoin:false,timer:[0,0,0,0,0],intervalFunc:null,timeoutChecking:null,timeoutDisconnected:null,outMes:{mes:\"\"},disconFlag:false,checkFlag:false,firstSnapShot:null,secondSnapShot:null,firstTimeDirect:true,mute_icon:\"black\",video_icon:\"black\",rem_mute_icon:\"black\",rem_video_icon:\"black\"};_this.usersRef=firebase.firestore().collection('Users');return _this;}_createClass(VideoPage,[{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.directVid&&(this.props.room_id!==\"\"||this.props.hostVid))this.startVideoDirectly();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(event){if(this.state.isStarted)this.hangUp(false,false);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProp){if(this.props.directVid!==prevProp.directVid)if(this.props.directVid)this.startVideoDirectly();}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/React.createElement(\"div\",{className:\"main-vid-page\"},/*#__PURE__*/React.createElement(Video,{localRef:localVideo,remoteRef:remoteVideo,timer:this.state.timer,fullScreenDisable:this.state.fullScreen,userName:this.props.userName,linkedName:this.props.linkedName,isConnected:this.state.isConnected,readyToJoin:this.state.readyToJoin,disconnectionStat:this.state.disconFlag,mute_icon:this.state.mute_icon,video_icon:this.state.video_icon,rem_mute_icon:this.state.rem_mute_icon,rem_video_icon:this.state.rem_video_icon,mute_func:this.mute,stop_vid_func:this.stopVideo}),/*#__PURE__*/React.createElement(Chat,{sendMessage:this.sendMessage,outMes:this.state.outMes,sendDisable:this.state.send_btn_disable,inputDisable:this.state.input_disable}),/*#__PURE__*/React.createElement(VidButtons,{startVideo:this.startVideo,createRoom:this.createRoom,joinRoom:this.joinRoom,hangUp:function hangUp(){return _this2.hangUp(true);},muteVis:this.state.muteVis,vidVis:this.state.vidVis,mute:this.mute,stopVideo:this.stopVideo,startDisable:this.state.start_btn_disable,hangDisable:this.state.hang_btn_disable,createDisable:this.state.create_btn_disable,joinDisable:this.state.join_btn_disable,linkedName:this.props.linkedName}),/*#__PURE__*/React.createElement(Credit,null));}}]);return VideoPage;}(Component);export default VideoPage;","map":{"version":3,"sources":["C:/Users/ahmad/Downloads/BigBrotherBigSisterIsrael-master/BigBrotherBigSisterIsrael-master/src/navBarComponents/videoComponents/main/VideoPage.jsx"],"names":["React","Component","Video","VidButtons","Chat","firebase","Credit","configuration","iceServers","urls","iceCandidatePoolSize","constraints","audio","video","width","ideal","height","localVideo","createRef","remoteVideo","VideoPage","props","startVideoDirectly","startVideo","checkIfStartedStream","setInterval","state","localStream","remoteStream","hostVid","createRoom","joinRoomById","room_id","clearInterval","navigator","mediaDevices","getUserMedia","then","stream","console","log","getVideoTracks","label","getAudioTracks","setState","MediaStream","current","srcObject","isStarted","hang_btn_disable","start_btn_disable","modifyVideoStream","catch","e","alert","name","modifyVideoNotAllowed","create_btn_disable","localPeer","RTCPeerConnection","getMediaTracks","getRemoteMediaTracks","handleDataChannel","createOffer","offer","roomOffer","type","sdp","usersRef","doc","linkId","collection","add","roomRef","connectionHandler","setLocalDescription","firstSnap","onSnapshot","snapshot","data","currentRemoteDescription","answer","id","RTCSessionDescription","setRemoteDescription","firstSnapShot","joinRoom","guestId","roomIdOfGuest","join_btn_disable","linkedName","document","location","reload","myLinkId","get","roomSnap","exists","readyToJoin","roomId","createAnswer","roomAnswer","update","hangUp","val","willReload","isConfirmed","window","confirm","isFinished","localChannel","readyState","remoteChannel","send","JSON","stringify","finish","secondSnapShot","intervalFunc","getTracks","forEach","track","stop","isConnected","timer","close","setTimeout","removeDocs","localName","remoteName","candidateCol","addEventListener","event","candidate","jsonData","toJSON","onconnectionstatechange","onIceChanged","secondSnap","docChanges","change","RTCIceCandidate","addIceCandidate","currStat","target","iceConnectionState","onCandidateConnected","onReconnection","onCandidateDisconnected","onCandidateChecking","mateDisconnected","muteVis","vidVis","send_btn_disable","input_disable","fullScreen","unavailableConnection","clearTimeout","timeoutDisconnected","disconFlag","checkCon","timeoutChecking","checkFlag","mute","enabled","mute_icon","stopVideo","video_icon","dataChannelName","dataPar","ordered","createDataChannel","binaryType","onopen","openDataChannel","onclose","closedDataChannel","ondatachannel","remoteOpenDataChannel","addTrack","streams","preventDefault","channel","onmessage","getMessage","newMessage","parse","outMes","mes","rem_mute_icon","rem_video_icon","sendMessage","message","firstTimeDirect","firestore","directVid","prevProp","userName"],"mappings":"+wCAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,MAAOC,CAAAA,KAAP,KAAkB,wBAAlB,CACA,MAAOC,CAAAA,UAAP,KAAuB,6BAAvB,CACA,MAAOC,CAAAA,IAAP,KAAiB,sBAAjB,CACA,MAAO,iBAAP,CACA,MAAOC,CAAAA,QAAP,KAAqB,0BAArB,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CAEA,GAAMC,CAAAA,aAAa,CAAG,CAAE;AACtBC,UAAU,CAAE,CACV,CACEC,IAAI,CAAE,CAAC,+BAAD,CAAkC,+BAAlC,CADR,CADU,CADQ,CAMpBC,oBAAoB,CAAE,EANF,CAAtB,CASA,GAAMC,CAAAA,WAAW,CAAG,CAClBC,KAAK,CAAE,IADW,CAElBC,KAAK,CAAE,CACLC,KAAK,CAAE,CAAEC,KAAK,CAAE,IAAT,CADF,CAELC,MAAM,CAAE,CAAED,KAAK,CAAE,IAAT,CAFH,CAFW,CAApB,CAQA,GAAME,CAAAA,UAAU,CAAGjB,KAAK,CAACkB,SAAN,EAAnB,CAEA,GAAMC,CAAAA,WAAW,CAAGnB,KAAK,CAACkB,SAAN,EAApB,C,GAEME,CAAAA,S,sGACJ,mBAAYC,KAAZ,CAAmB,2CACjB,uBAAMA,KAAN,EADiB,MAwCnBC,kBAxCmB,CAwCE,UAAM,CAAE;AAC3B,MAAKC,UAAL,GACA,GAAIC,CAAAA,oBAAoB,CAAGC,WAAW,CAAC,UAAM,CAC3C,GAAI,MAAKC,KAAL,CAAWC,WAAX,EAA0B,MAAKD,KAAL,CAAWE,YAAzC,CAAuD,CACrD,GAAI,MAAKP,KAAL,CAAWQ,OAAf,CACE,MAAKC,UAAL,GADF,IAGE,OAAKC,YAAL,CAAkB,MAAKV,KAAL,CAAWW,OAA7B,EACFC,aAAa,CAACT,oBAAD,CAAb,CACD,CACF,CARqC,CAQnC,GARmC,CAAtC,CASD,CAnDkB,OAqEnBD,UArEmB,sEAqEN,wIACXW,SAAS,CAACC,YAAV,CAAuBC,YAAvB,CAAoCzB,WAApC,EACG0B,IADH,CACQ,SAAAC,MAAM,CAAI,CACdC,OAAO,CAACC,GAAR,CAAY,2EACVF,MAAM,CAACG,cAAP,GAAwB,CAAxB,EAA2BC,KADjB,CACyB,wBADzB,CACoDJ,MAAM,CAACK,cAAP,GAAwB,CAAxB,EAA2BD,KAD3F,EAEA,MAAKE,QAAL,CAAc,CAAEhB,YAAY,CAAE,GAAIiB,CAAAA,WAAJ,EAAhB,CAAd,CAAmD,UAAM,CACvD1B,WAAW,CAAC2B,OAAZ,CAAoBC,SAApB,CAAgC,MAAKrB,KAAL,CAAWE,YAA3C,CACD,CAFD,EAGA,MAAKgB,QAAL,CAAc,CAAEjB,WAAW,CAAEW,MAAf,CAAd,sEAAuC,mIACrCrB,UAAU,CAAC6B,OAAX,CAAmBC,SAAnB,CAA+B,MAAKrB,KAAL,CAAWC,WAA1C,CACA,MAAKiB,QAAL,CAAc,CACZI,SAAS,CAAE,IADC,CAEZC,gBAAgB,CAAE,KAFN,CAEaC,iBAAiB,CAAE,IAFhC,CAAd,EAIA,MAAK7B,KAAL,CAAW8B,iBAAX,GAAgC;AANK,sDAAvC,IAQD,CAfH,EAgBGC,KAhBH,CAgBS,SAAAC,CAAC,CAAI,CACVC,KAAK,CAACD,CAAC,CAACE,IAAH,CAAL,CACA,MAAKlC,KAAL,CAAWmC,qBAAX,GACD,CAnBH,EADW,wDArEM,SA4FnB1B,UA5FmB,sEA4FN,2IACN,MAAKJ,KAAL,CAAWsB,SADL,0BAETM,KAAK,CAAC,oCAAD,CAAL,CAFS,yCAMX,MAAKV,QAAL,CAAc,CAAEa,kBAAkB,CAAE,IAAtB,CAAd,EAEA,MAAKb,QAAL,CAAc,CAAEc,SAAS,CAAE,GAAIC,CAAAA,iBAAJ,CAAsBpD,aAAtB,CAAb,CAAd,sEAAmE,8KAAgB;AACjFgC,OAAO,CAACC,GAAR,CAAY,oBAAZ,EACA,MAAKoB,cAAL,GACA,MAAKC,oBAAL,GACA,MAAKC,iBAAL,CAAuB,eAAvB,EAJiE,uBAO7C,OAAKpC,KAAL,CAAWgC,SAAX,CAAqBK,WAArB,EAP6C,QAO3DC,KAP2D,gBAOT;AAElDC,SAT2D,CAS/C,CAChBD,KAAK,CAAE,CACLE,IAAI,CAAEF,KAAK,CAACE,IADP,CAELC,GAAG,CAAEH,KAAK,CAACG,GAFN,CADS,CAT+C,yBAgB3C,OAAKC,QAAL,CACnBC,GADmB,CACf,MAAKhD,KAAL,CAAWiD,MADI,EAEnBC,UAFmB,CAER,OAFQ,EAGnBC,GAHmB,CAGfP,SAHe,CAhB2C,SAgB3DQ,OAhB2D,gBAqBjE,MAAKC,iBAAL,CAAuBD,OAAvB,CAAgC,mBAAhC,CAAqD,oBAArD,EAA4E;AArBX,0CAuBzD,OAAK/C,KAAL,CAAWgC,SAAX,CAAqBiB,mBAArB,CAAyCX,KAAzC,CAvByD,+FA0B/DzB,OAAO,CAACC,GAAR,CAAY,aAAEe,IAAd,EA1B+D,QA4B7DqB,SA5B6D,CA4BjDH,OAAO,CAACI,UAAR,2FAAmB,kBAAMC,QAAN,sIAAoB;AAC/CC,IAD2B,CACpBD,QAAQ,CAACC,IAAT,EADoB,uBAG3B,CAAC,MAAKrD,KAAL,CAAWgC,SAAX,CAAqBsB,wBAAtB,EAAkD,MAAQD,CAAAA,IAAI,CAACE,MAAb,GAAyB,WAHhD,2BAI7B1C,OAAO,CAACC,GAAR,8BAAkCsC,QAAQ,CAACI,EAA3C,GACA3C,OAAO,CAACC,GAAR,mCAAuCuC,IAAI,CAACE,MAA5C,GACMA,MANuB,CAMd,GAAIE,CAAAA,qBAAJ,CAA0BJ,IAAI,CAACE,MAA/B,CANc,CAO7B1C,OAAO,CAACC,GAAR,CAAYyC,MAAZ,EAP6B,uBAQvB,OAAKvD,KAAL,CAAWgC,SAAX,CAAqB0B,oBAArB,CAA0CH,MAA1C,CARuB,6FAY/B1C,OAAO,CAACC,GAAR,CAAY,aAAEe,IAAd,EAZ+B,uEAAnB,gEA5BiD,CA2CjE,MAAKX,QAAL,CAAc,CAAEyC,aAAa,CAAET,SAAjB,CAAd,EA3CiE,wEAAnE,IARW,wDA5FM,SAmJnBU,QAnJmB,CAmJR,SAACC,OAAD,CAAa,CAAE;AACxB,GAAI,CAAC,MAAK7D,KAAL,CAAWsB,SAAhB,CAA2B,CACzBM,KAAK,CAAC,8BAAD,CAAL,CACA,OACD,CACD,GAAIiC,OAAO,GAAK,EAAhB,CAAoB,CAClBjC,KAAK,CAAC,qCAAD,CAAL,CACA,OACD,CACD,MAAKvB,YAAL,CAAkBwD,OAAlB,EACD,CA7JkB,OA+JnBxD,YA/JmB,2FA+JJ,kBAAOyD,aAAP,2IACb,MAAK5C,QAAL,CAAc,CACZa,kBAAkB,CAAE,IADR,CAEZgC,gBAAgB,CAAE,IAFN,CAAd,EAIAlD,OAAO,CAACC,GAAR,iCAAqCgD,aAArC,GALa,KAMTA,aAAa,GAAK,EANT,2BAOXlC,KAAK,CAAC,MAAKjC,KAAL,CAAWqE,UAAX,CAAwB,gBAAzB,CAAL,CACAC,QAAQ,CAACC,QAAT,CAAkBC,MAAlB,CAAyB,IAAzB,EARW,yCAYPpB,OAZO,CAYG,MAAKL,QAAL,CACbC,GADa,CACT,MAAKhD,KAAL,CAAWyE,QADF,EAEbvB,UAFa,CAEF,OAFE,EAGbF,GAHa,WAGNmB,aAHM,EAZH,wBAgBUf,CAAAA,OAAO,CAACsB,GAAR,EAhBV,QAgBPC,QAhBO,gBAiBbzD,OAAO,CAACC,GAAR,iCAAqCwD,QAAQ,CAACC,MAA9C,GAjBa,GAmBRD,QAAQ,CAACC,MAnBD,2BAoBX3C,KAAK,CAAC,+BAAD,CAAL,CACA,MAAKV,QAAL,CAAc,CACZa,kBAAkB,CAAE,KADR,CAEZgC,gBAAgB,CAAE,KAFN,CAAd,EArBW,0CA2Bb,MAAK7C,QAAL,CAAc,CAAEsD,WAAW,CAAE,IAAf,CAAqBC,MAAM,CAAE,uBAAyB1B,OAAO,CAACS,EAA9D,CAAd,EACA3C,OAAO,CAACC,GAAR,4DAAgEjC,aAAhE,GACA,MAAKqC,QAAL,CAAc,CAAEc,SAAS,CAAE,GAAIC,CAAAA,iBAAJ,CAAsBpD,aAAtB,CAAb,CAAd,sEAAmE,oKACjEgC,OAAO,CAACC,GAAR,CAAY,oBAAZ,EACA,MAAKoB,cAAL,GACA,MAAKC,oBAAL,GACA,MAAKC,iBAAL,CAAuB,gBAAvB,EAEA,MAAKY,iBAAL,CAAuBD,OAAvB,CAAgC,oBAAhC,CAAsD,mBAAtD,EAA4E;AAEtET,KAR2D,CAQnDgC,QAAQ,CAACjB,IAAT,GAAgBf,KARmC,CASjEzB,OAAO,CAACC,GAAR,CAAY,eAAZ,EATiE,uBAU3D,OAAKd,KAAL,CAAWgC,SAAX,CAAqB0B,oBAArB,CAA0CpB,KAA1C,CAV2D,gCAW5C,OAAKtC,KAAL,CAAWgC,SAAX,CAAqB0C,YAArB,EAX4C,SAW3DnB,MAX2D,wCAY3D,OAAKvD,KAAL,CAAWgC,SAAX,CAAqBiB,mBAArB,CAAyCM,MAAzC,CAZ2D,SAa3DoB,UAb2D,CAa9C,CACjBpB,MAAM,CAAE,CACNf,IAAI,CAAEe,MAAM,CAACf,IADP,CAENC,GAAG,CAAEc,MAAM,CAACd,GAFN,CADS,CAb8C,yBAmB3DM,CAAAA,OAAO,CAAC6B,MAAR,CAAeD,UAAf,CAnB2D,0DAAnE,IA7Ba,yDA/JI,uEAmNnBE,MAnNmB,CAmNV,SAACC,GAAD,CAA4B,IAAtBC,CAAAA,UAAsB,2DAAT,IAAS,CACnC,GAAIC,CAAAA,WAAJ,CACA,GAAI,CAACF,GAAL,CACEE,WAAW,CAAG,IAAd,CADF,IAGEA,CAAAA,WAAW,CAAGC,MAAM,CAACC,OAAP,CAAe,sCAAf,CAAd,CACF,GAAIF,WAAJ,CAAiB,CACf,MAAK9D,QAAL,CAAc,CAAEiE,UAAU,CAAE,IAAd,CAAd,EACA,GAAI,MAAKnF,KAAL,CAAWoF,YAAX,EAA2B,MAAKpF,KAAL,CAAWoF,YAAX,CAAwBC,UAAxB,GAAuC,MAAlE,EACF,MAAKrF,KAAL,CAAWsF,aADT,GAC2BR,GAAG,EAAI,CAACC,UADnC,CAAJ,CAEE,MAAK/E,KAAL,CAAWoF,YAAX,CAAwBG,IAAxB,CAA6BC,IAAI,CAACC,SAAL,CAAe,CAAEC,MAAM,CAAE,IAAV,CAAf,CAA7B,EACF,GAAI,MAAK1F,KAAL,CAAW2D,aAAX,GAA6B,IAAjC,CACE,MAAK3D,KAAL,CAAW2D,aAAX,GACF,GAAI,MAAK3D,KAAL,CAAW2F,cAAX,GAA8B,IAAlC,CACE,MAAK3F,KAAL,CAAW2F,cAAX,GACFpF,aAAa,CAAC,MAAKP,KAAL,CAAW4F,YAAZ,CAAb,CACA,MAAK5F,KAAL,CAAWC,WAAX,CAAuB4F,SAAvB,GAAmCC,OAAnC,CAA2C,SAAAC,KAAK,QAAIA,CAAAA,KAAK,CAACC,IAAN,EAAJ,EAAhD,EACAnF,OAAO,CAACC,GAAR,CAAY,qBAAZ,EACA,GAAI,MAAKd,KAAL,CAAWE,YAAf,CAA6B,CAC3B,MAAKF,KAAL,CAAWE,YAAX,CAAwB2F,SAAxB,GAAoCC,OAApC,CAA4C,SAAAC,KAAK,QAAIA,CAAAA,KAAK,CAACC,IAAN,EAAJ,EAAjD,EACAnF,OAAO,CAACC,GAAR,CAAY,sBAAZ,EACD,CACD,GAAIgE,GAAG,EAAIC,UAAP,EAAqB,MAAK/E,KAAL,CAAWiG,WAApC,CACErE,KAAK,CAAC,8BACJ,MAAK5B,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CADI,CACkB,GADlB,CACwB,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CADxB,CAC8C,EAD9C,CAEJ,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAFI,CAEkB,GAFlB,CAEwB,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAFxB,CAE8C,EAF9C,CAGJ,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAHG,CAAL,CADF,IAKK,IAAI,CAACpB,GAAD,EAAQC,UAAR,EAAsB,MAAK/E,KAAL,CAAWiG,WAArC,CACHrE,KAAK,CAAC,cACJ,MAAK5B,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CADI,CACkB,GADlB,CACwB,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CADxB,CAC8C,EAD9C,CAEJ,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAFI,CAEkB,GAFlB,CAEwB,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAFxB,CAE8C,EAF9C,CAGJ,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAHG,CAAL,CAIF,GAAI,MAAKlG,KAAL,CAAWgC,SAAX,GAAyB,IAA7B,CAAmC,CACjC,MAAKhC,KAAL,CAAWgC,SAAX,CAAqBmE,KAArB,GACAtF,OAAO,CAACC,GAAR,CAAY,mBAAZ,EACD,CACD,MAAKI,QAAL,CAAc,CAAEc,SAAS,CAAE,IAAb,CAAd,EACA,GAAI+C,UAAJ,CAAgB,CACdqB,UAAU,CAAC,UAAM,CACfnC,QAAQ,CAACC,QAAT,CAAkBC,MAAlB,CAAyB,IAAzB,EACD,CAFS,CAEP,GAFO,CAAV,CAGD,CAJD,IAME,OAAKxE,KAAL,CAAW0G,UAAX,GACH,CACF,CAhQkB,OAkQnBrD,iBAlQmB,2FAkQC,kBAAOD,OAAP,CAAgBuD,SAAhB,CAA2BC,UAA3B,kJAA4C;AACxDC,YADY,CACGzD,OAAO,CAACF,UAAR,CAAmByD,SAAnB,CADH,CAElB,GAAI,CACF,MAAKtG,KAAL,CAAWgC,SAAX,CAAqByE,gBAArB,CAAsC,cAAtC,CAAsD,SAAAC,KAAK,CAAI,CAC7D,GAAIA,KAAK,CAACC,SAAV,CAAqB,CACnB,GAAMC,CAAAA,QAAQ,CAAGF,KAAK,CAACC,SAAN,CAAgBE,MAAhB,EAAjB,CACAL,YAAY,CAAC1D,GAAb,CAAiB8D,QAAjB,EACD,CACF,CALD,EAMD,CACD,MAAOjF,CAAP,CAAU,CACRd,OAAO,CAACC,GAAR,CAAYa,CAAC,CAACE,IAAd,EACD,CACD,GAAI,CACF,MAAK7B,KAAL,CAAWgC,SAAX,CAAqB8E,uBAArB,CAA+C,MAAKC,YAApD,CACD,CACD,MAAOpF,CAAP,CAAU,CACRd,OAAO,CAACC,GAAR,CAAYa,CAAC,CAACE,IAAd,EACD,CACGmF,UAnBc,CAmBDjE,OAAO,CAACF,UAAR,CAAmB0D,UAAnB,EAA+BpD,UAA/B,CAA0C,SAAAC,QAAQ,CAAI,CACrEA,QAAQ,CAAC6D,UAAT,GAAsBnB,OAAtB,CAA8B,SAAAoB,MAAM,CAAI,CACtC,GAAIA,MAAM,CAAC1E,IAAP,GAAgB,OAAhB,EAA2B0E,MAAM,CAACvE,GAAP,CAAWU,IAAX,EAA/B,CAAkD,CAChD,GAAMsD,CAAAA,SAAS,CAAG,GAAIQ,CAAAA,eAAJ,CAAoBD,MAAM,CAACvE,GAAP,CAAWU,IAAX,EAApB,CAAlB,CACA,MAAKrD,KAAL,CAAWgC,SAAX,CAAqBoF,eAArB,CAAqCT,SAArC,EACA9F,OAAO,CAACC,GAAR,sBACD,CACF,CAND,EAOD,CARgB,CAnBC,CA4BlB,MAAKI,QAAL,CAAc,CAAEyE,cAAc,CAAEqB,UAAlB,CAAd,EA5BkB,wDAlQD,+EAiSnBD,YAjSmB,CAiSJ,SAACpF,CAAD,CAAO,CAAE;AACtB,GAAI0F,CAAAA,QAAQ,CAAG1F,CAAC,CAAC2F,MAAjB,CACAzG,OAAO,CAACC,GAAR,yCAA6CuG,QAAQ,CAACE,kBAAtD,GACA,GAAIF,QAAQ,CAACE,kBAAT,GAAgC,WAAhC,EAA+C,CAAC,MAAKvH,KAAL,CAAWiG,WAA/D,CAA4E;AAC1E,MAAKuB,oBAAL,GADF,IAEK,IAAIH,QAAQ,CAACE,kBAAT,GAAgC,WAAhC,EAA+C,MAAKvH,KAAL,CAAWiG,WAA9D,CAA2E;AAC9E,MAAKwB,cAAL,GADG,IAEA,IAAIJ,QAAQ,CAACE,kBAAT,GAAgC,cAAhC,EAAkD,MAAKvH,KAAL,CAAWiG,WAAjE,CAA8E;AACjF,MAAKyB,uBAAL,GADG,IAEA,IAAI,CAACL,QAAQ,CAACE,kBAAT,GAAgC,cAAhC,EAAkDF,QAAQ,CAACE,kBAAT,GAAgC,UAAnF,GACJ,CAAC,MAAKvH,KAAL,CAAWiG,WADZ,CACyB;AAC5B,MAAK0B,mBAAL,GACH,CA7SkB,OA+SnBC,gBA/SmB,CA+SA,UAAM,CACvBrH,aAAa,CAAC,MAAKP,KAAL,CAAW4F,YAAZ,CAAb,CACAhE,KAAK,CAAC,MAAKjC,KAAL,CAAWqE,UAAX,CAAwB,iBAAzB,CAAL,CACA,MAAKa,MAAL,CAAY,KAAZ,EACD,CAnTkB,OAqTnB2C,oBArTmB,CAqTI,UAAM,CAC3B3G,OAAO,CAACC,GAAR,CAAY,+BAAZ,EACA,MAAKI,QAAL,CAAc,CACZ+E,WAAW,CAAE,IADD,CACO4B,OAAO,CAAE,SADhB,CAEZC,MAAM,CAAE,SAFI,CAEO/F,kBAAkB,CAAE,IAF3B,CAGZgC,gBAAgB,CAAE,IAHN,CAGYgE,gBAAgB,CAAE,KAH9B,CAIZC,aAAa,CAAE,KAJH,CAIUC,UAAU,CAAE,KAJtB,CAAd,EAMA,GAAI,MAAKjI,KAAL,CAAW4F,YAAX,GAA4B,IAAhC,CACE,MAAK1E,QAAL,CAAc,CAAE0E,YAAY,CAAE7F,WAAW,CAAC,MAAK6F,YAAN,CAAoB,IAApB,CAA3B,CAAd,EACH,CA/TkB,OAiUnBsC,qBAjUmB,CAiUK,UAAM,CAC5BC,YAAY,CAAC,MAAKjH,QAAL,CAAckH,mBAAf,CAAZ,CACA,GAAIb,CAAAA,kBAAkB,CAAG,MAAKvH,KAAL,CAAWgC,SAAX,CAAqBuF,kBAA9C,CACA,GAAIA,kBAAkB,GAAK,cAAvB,EAAyCA,kBAAkB,GAAK,UAApE,CAAgF,CAC9EhH,aAAa,CAAC,MAAKP,KAAL,CAAW4F,YAAZ,CAAb,CACAhE,KAAK,CAAC,MAAKjC,KAAL,CAAWqE,UAAX,CAAwB,0CAAzB,CAAL,CACA,MAAKa,MAAL,CAAY,KAAZ,EACD,CACF,CAzUkB,OA2UnB4C,cA3UmB,CA2UF,UAAM,CACrB,MAAKvG,QAAL,CAAc,CAAEmH,UAAU,CAAE,KAAd,CAAd,EACD,CA7UkB,OA+UnBX,uBA/UmB,CA+UO,UAAM,CAC9B,GAAI,CAAC,MAAK1H,KAAL,CAAWqI,UAAhB,CAA4B,CAC1B,MAAKnH,QAAL,CAAc,CACZkH,mBAAmB,CAAEhC,UAAU,CAAC,MAAK8B,qBAAN,CAA6B,KAA7B,CADnB,CAEZG,UAAU,CAAE,IAFA,CAAd,EAID,CACF,CAtVkB,OAwVnBC,QAxVmB,CAwVR,UAAM,CACfH,YAAY,CAAC,MAAKnI,KAAL,CAAWuI,eAAZ,CAAZ,CACA,GAAI,CAAC,MAAKvI,KAAL,CAAWiG,WAAhB,CAA6B,CAC3B1F,aAAa,CAAC,MAAKP,KAAL,CAAW4F,YAAZ,CAAb,CACAhE,KAAK,CAAC,kDAAD,CAAL,CACA,MAAKiD,MAAL,CAAY,KAAZ,EACD,CAJD,IAME,OAAK3D,QAAL,CAAc,CAAEsH,SAAS,CAAE,KAAb,CAAd,EACH,CAjWkB,OAmWnBb,mBAnWmB,CAmWG,UAAM,CAC1B,GAAI,CAAC,MAAK3H,KAAL,CAAWwI,SAAhB,CACE,MAAKtH,QAAL,CAAc,CACZqH,eAAe,CAAEnC,UAAU,CAAC,MAAKkC,QAAN,CAAgB,KAAhB,CADf,CAEZE,SAAS,CAAE,IAFC,CAEKhE,WAAW,CAAE,IAFlB,CAAd,EAIH,CAzWkB,OA2WnBoB,YA3WmB,CA2WJ,UAAM,CACnB,GAAI,MAAK5F,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CAA5B,CACE,MAAKhF,QAAL,CAAc,CACZgF,KAAK,CAAE,CAAC,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAAD,CACP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CADO,CAEP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAFO,CAGP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAHO,CAIP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,EAAsB,CAJf,CADK,CAAd,EADF,IAQK,IAAI,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CAAxB,EACJ,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CADxB,CAEH,MAAKhF,QAAL,CAAc,CACZgF,KAAK,CAAE,CAAC,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAAD,CACP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CADO,CAEP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAFO,CAGP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,EAAsB,CAHf,CAGkB,CAHlB,CADK,CAAd,EAFG,IAQA,IAAI,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CAAxB,EACP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CADjB,EAEP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CAFrB,CAGH,MAAKhF,QAAL,CAAc,CACZgF,KAAK,CAAE,CAAC,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAAD,CACP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CADO,CAEP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,EAAsB,CAFf,CAEkB,CAFlB,CAEqB,CAFrB,CADK,CAAd,EAHG,IAQA,IAAI,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CAAxB,EACP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CADjB,EAEP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CAFjB,EAGP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,IAAwB,CAHrB,CAIH,MAAKhF,QAAL,CAAc,CACZgF,KAAK,CAAE,CAAC,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAAD,CACP,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,EAAsB,CADf,CACkB,CADlB,CACqB,CADrB,CACwB,CADxB,CADK,CAAd,EAJG,IASH,OAAKhF,QAAL,CAAc,CACZgF,KAAK,CAAE,CAAC,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,EAAsB,CAAvB,CAA0B,CAA1B,CAA6B,CAA7B,CAAgC,CAAhC,CAAmC,CAAnC,CADK,CAAd,EAGH,CAhZkB,OAkZnBuC,IAlZmB,CAkZZ,UAAM,CACX,GAAI,MAAKzI,KAAL,CAAWC,WAAX,CAAuBgB,cAAvB,GAAwC,CAAxC,EAA2CyH,OAA/C,CAAwD,CACtD,MAAKxH,QAAL,CAAc,CAAEyH,SAAS,CAAE,MAAb,CAAd,EACA,MAAK3I,KAAL,CAAWoF,YAAX,CAAwBG,IAAxB,CAA6BC,IAAI,CAACC,SAAL,CAAe,CAAEgD,IAAI,CAAE,IAAR,CAAf,CAA7B,EACD,CAHD,IAIK,CACH,MAAKvH,QAAL,CAAc,CAAEyH,SAAS,CAAE,OAAb,CAAd,EACA,MAAK3I,KAAL,CAAWoF,YAAX,CAAwBG,IAAxB,CAA6BC,IAAI,CAACC,SAAL,CAAe,CAAEgD,IAAI,CAAE,KAAR,CAAf,CAA7B,EACD,CACD,MAAKzI,KAAL,CAAWC,WAAX,CAAuBgB,cAAvB,GAAwC,CAAxC,EAA2CyH,OAA3C,CAAqD,CAAE,MAAK1I,KAAL,CAAWC,WAAX,CAAuBgB,cAAvB,GAAwC,CAAxC,EAA2CyH,OAAlG,CACD,CA5ZkB,OA8ZnBE,SA9ZmB,CA8ZP,UAAM,CAChB,GAAI,MAAK5I,KAAL,CAAWC,WAAX,CAAuBc,cAAvB,GAAwC,CAAxC,EAA2C2H,OAA/C,CAAwD,CACtD,MAAKxH,QAAL,CAAc,CAAE2H,UAAU,CAAE,MAAd,CAAd,EACA,MAAK7I,KAAL,CAAWoF,YAAX,CAAwBG,IAAxB,CAA6BC,IAAI,CAACC,SAAL,CAAe,CAAEtG,KAAK,CAAE,IAAT,CAAf,CAA7B,EACD,CAHD,IAIK,CACH,MAAK+B,QAAL,CAAc,CAAE2H,UAAU,CAAE,OAAd,CAAd,EACA,MAAK7I,KAAL,CAAWoF,YAAX,CAAwBG,IAAxB,CAA6BC,IAAI,CAACC,SAAL,CAAe,CAAEtG,KAAK,CAAE,KAAT,CAAf,CAA7B,EACD,CACD,MAAKa,KAAL,CAAWC,WAAX,CAAuBc,cAAvB,GAAwC,CAAxC,EAA2C2H,OAA3C,CAAqD,CAAE,MAAK1I,KAAL,CAAWC,WAAX,CAAuBc,cAAvB,GAAwC,CAAxC,EAA2C2H,OAAlG,CACD,CAxakB,OA0anBtG,iBA1amB,2FA0aC,kBAAO0G,eAAP,kIAClB;AACMC,OAFY,CAEF,CAAEC,OAAO,CAAE,IAAX,CAFE,CAGlB,MAAK9H,QAAL,CAAc,CAAEkE,YAAY,CAAE,MAAKpF,KAAL,CAAWgC,SAAX,CAAqBiH,iBAArB,CAAuCH,eAAvC,CAAwDC,OAAxD,CAAhB,CAAd,CACE,UAAM,CACJ,MAAK/I,KAAL,CAAWoF,YAAX,CAAwB8D,UAAxB,CAAqC,aAArC,CACA,MAAKlJ,KAAL,CAAWoF,YAAX,CAAwB+D,MAAxB,CAAiC,MAAKC,eAAtC,CACA,MAAKpJ,KAAL,CAAWoF,YAAX,CAAwBiE,OAAxB,CAAkC,MAAKC,iBAAvC,CACA,MAAKtJ,KAAL,CAAWgC,SAAX,CAAqBuH,aAArB,CAAqC,MAAKC,qBAA1C,CACD,CANH,EAHkB,wDA1aD,uEAsbnBtH,cAtbmB,sEAsbF,6IACf,GAAI,MAAQ,OAAKlC,KAAL,CAAWC,WAAnB,GAAoC,WAAxC,CAAqD,CACnD,MAAKD,KAAL,CAAWC,WAAX,CAAuB4F,SAAvB,GACGC,OADH,CACW,SAAAC,KAAK,QAAI,OAAK/F,KAAL,CAAWgC,SAAX,CACfyH,QADe,CACN1D,KADM,CACC,MAAK/F,KAAL,CAAWC,WADZ,CAAJ,EADhB,EAGAY,OAAO,CAACC,GAAR,CAAY,gCAAZ,EACD,CANc,0DAtbE,SA+bnBqB,oBA/bmB,sEA+bI,6IACrB,MAAKnC,KAAL,CAAWgC,SAAX,CAAqByE,gBAArB,CAAsC,OAAtC,CAA+C,SAAAC,KAAK,CAAI,CACtD7F,OAAO,CAACC,GAAR,6BAAiC4F,KAAK,CAACgD,OAAN,CAAc,CAAd,CAAjC,GACAhD,KAAK,CAACgD,OAAN,CAAc,CAAd,EAAiB7D,SAAjB,GAA6BC,OAA7B,CAAqC,SAAAC,KAAK,CAAI,CAC5ClF,OAAO,CAACC,GAAR,6CAAiDiF,KAAjD,GACA,MAAK/F,KAAL,CAAWE,YAAX,CAAwBuJ,QAAxB,CAAiC1D,KAAjC,EACD,CAHD,EAID,CAND,EADqB,0DA/bJ,SAycnBqD,eAzcmB,sEAycD,6IAChBvI,OAAO,CAACC,GAAR,CAAY,0BAAZ,EADgB,0DAzcC,SA6cnBwI,iBA7cmB,sEA6cC,6IAClBzI,OAAO,CAACC,GAAR,CAAY,0BAAZ,EACA,GAAI,MAAKd,KAAL,CAAWiG,WAAX,EAA0B,CAAC,MAAKjG,KAAL,CAAWmF,UAA1C,CACEvD,KAAK,CAAC,8BACJ,MAAK5B,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CADI,CACkB,GADlB,CACwB,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CADxB,CAC8C,EAD9C,CAEJ,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAFI,CAEkB,GAFlB,CAEwB,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAFxB,CAE8C,EAF9C,CAGJ,MAAKlG,KAAL,CAAWkG,KAAX,CAAiB,CAAjB,CAHG,CAAL,CAHgB,0DA7cD,SAsdnBsD,qBAtdmB,4FAsdK,mBAAO9C,KAAP,0HACtBA,KAAK,CAACiD,cAAN,GACA,MAAKzI,QAAL,CAAc,CAAEoE,aAAa,CAAEoB,KAAK,CAACkD,OAAvB,CAAd,CAAgD,UAAM,CACpD,MAAK5J,KAAL,CAAWsF,aAAX,CAAyBuE,SAAzB,CAAqC,MAAKC,UAA1C,CACD,CAFD,EAFsB,0DAtdL,wEA6dnBA,UA7dmB,4FA6dN,mBAAOpD,KAAP,yIACXA,KAAK,CAACiD,cAAN,GACII,UAFO,CAEMvE,IAAI,CAACwE,KAAL,CAAWtD,KAAK,CAACrD,IAAjB,CAFN,CAGX,GAAI,MAAQ0G,CAAAA,UAAR,GAAwB,QAA5B,CACE,MAAK7I,QAAL,CAAc,CAAE+I,MAAM,CAAE,CAAEC,GAAG,CAAEH,UAAP,CAAV,CAAd,EADF,IAEK,IAAIA,UAAU,CAACrE,MAAX,GAAsB,IAA1B,CACH,MAAKxE,QAAL,CAAc,CAAEiE,UAAU,CAAE,IAAd,CAAd,CAAoC,MAAKyC,gBAAL,EAApC,EADG,IAEA,IAAImC,UAAU,CAACtB,IAAX,GAAoB,IAAxB,CACH,MAAKvH,QAAL,CAAc,CAAEiJ,aAAa,CAAE,MAAjB,CAAd,EADG,IAEA,IAAIJ,UAAU,CAACtB,IAAX,GAAoB,KAAxB,CACH,MAAKvH,QAAL,CAAc,CAAEiJ,aAAa,CAAE,OAAjB,CAAd,EADG,IAEA,IAAIJ,UAAU,CAAC5K,KAAX,GAAqB,IAAzB,CACH,MAAK+B,QAAL,CAAc,CAAEkJ,cAAc,CAAE,MAAlB,CAAd,EADG,IAEA,IAAIL,UAAU,CAAC5K,KAAX,GAAqB,KAAzB,CACH,MAAK+B,QAAL,CAAc,CAAEkJ,cAAc,CAAE,OAAlB,CAAd,EAdS,0DA7dM,wEA8enBC,WA9emB,4FA8eL,mBAAOC,OAAP,0HACZ,MAAKtK,KAAL,CAAWoF,YAAX,CAAwBG,IAAxB,CAA6BC,IAAI,CAACC,SAAL,CAAe6E,OAAf,CAA7B,EACAzJ,OAAO,CAACC,GAAR,CAAY,yBAA2BwJ,OAAvC,EAFY,0DA9eK,kEAEjB,MAAKtK,KAAL,CAAa,CACXC,WAAW,CAAE,IADF,CAEXC,YAAY,CAAE,IAFH,CAGX8B,SAAS,CAAE,IAHA,CAIXyC,MAAM,CAAE,EAJG,CAKXW,YAAY,CAAE,IALH,CAMXE,aAAa,CAAE,IANJ,CAOX9D,iBAAiB,CAAE,KAPR,CAQXD,gBAAgB,CAAE,IARP,CASXQ,kBAAkB,CAAE,KATT,CAUXgC,gBAAgB,CAAE,KAVP,CAWXgE,gBAAgB,CAAE,IAXP,CAYXC,aAAa,CAAE,IAZJ,CAaXC,UAAU,CAAE,IAbD,CAcXJ,OAAO,CAAE,QAdE,CAeXC,MAAM,CAAE,QAfG,CAgBXxG,SAAS,CAAE,KAhBA,CAiBX2E,WAAW,CAAE,KAjBF,CAkBXd,UAAU,CAAE,KAlBD,CAmBXX,WAAW,CAAE,KAnBF,CAoBX0B,KAAK,CAAE,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAAU,CAAV,CAAa,CAAb,CApBI,CAqBXN,YAAY,CAAE,IArBH,CAsBX2C,eAAe,CAAE,IAtBN,CAuBXH,mBAAmB,CAAE,IAvBV,CAwBX6B,MAAM,CAAE,CAAEC,GAAG,CAAE,EAAP,CAxBG,CAyBX7B,UAAU,CAAE,KAzBD,CA0BXG,SAAS,CAAE,KA1BA,CA2BX7E,aAAa,CAAE,IA3BJ,CA4BXgC,cAAc,CAAE,IA5BL,CA6BX4E,eAAe,CAAE,IA7BN,CA8BX5B,SAAS,CAAE,OA9BA,CA+BXE,UAAU,CAAE,OA/BD,CAgCXsB,aAAa,CAAE,OAhCJ,CAiCXC,cAAc,CAAE,OAjCL,CAAb,CAmCA,MAAK1H,QAAL,CAAgB/D,QAAQ,CAAC6L,SAAT,GAAqB3H,UAArB,CAAgC,OAAhC,CAAhB,CArCiB,aAsClB,C,mFAemB,CAClB,GAAI,KAAKlD,KAAL,CAAW8K,SAAX,GAAyB,KAAK9K,KAAL,CAAWW,OAAX,GAAuB,EAAvB,EAA6B,KAAKX,KAAL,CAAWQ,OAAjE,CAAJ,CACE,KAAKP,kBAAL,GACH,C,kEAEoB8G,K,CAAO,CAC1B,GAAI,KAAK1G,KAAL,CAAWsB,SAAf,CACE,KAAKuD,MAAL,CAAY,KAAZ,CAAmB,KAAnB,EACH,C,8DAEkB6F,Q,CAAU,CAC3B,GAAI,KAAK/K,KAAL,CAAW8K,SAAX,GAAyBC,QAAQ,CAACD,SAAtC,CACE,GAAI,KAAK9K,KAAL,CAAW8K,SAAf,CACE,KAAK7K,kBAAL,GACL,C,uCAgbQ,iBACP,mBACE,2BAAK,SAAS,CAAC,eAAf,eAEE,oBAAC,KAAD,EACE,QAAQ,CAAEL,UADZ,CAEE,SAAS,CAAEE,WAFb,CAGE,KAAK,CAAE,KAAKO,KAAL,CAAWkG,KAHpB,CAIE,iBAAiB,CAAE,KAAKlG,KAAL,CAAWiI,UAJhC,CAKE,QAAQ,CAAE,KAAKtI,KAAL,CAAWgL,QALvB,CAME,UAAU,CAAE,KAAKhL,KAAL,CAAWqE,UANzB,CAOE,WAAW,CAAE,KAAKhE,KAAL,CAAWiG,WAP1B,CAQE,WAAW,CAAE,KAAKjG,KAAL,CAAWwE,WAR1B,CASE,iBAAiB,CAAE,KAAKxE,KAAL,CAAWqI,UAThC,CAUE,SAAS,CAAE,KAAKrI,KAAL,CAAW2I,SAVxB,CAWE,UAAU,CAAE,KAAK3I,KAAL,CAAW6I,UAXzB,CAYE,aAAa,CAAE,KAAK7I,KAAL,CAAWmK,aAZ5B,CAaE,cAAc,CAAE,KAAKnK,KAAL,CAAWoK,cAb7B,CAcE,SAAS,CAAE,KAAK3B,IAdlB,CAeE,aAAa,CAAE,KAAKG,SAftB,EAFF,cAoBE,oBAAC,IAAD,EACE,WAAW,CAAE,KAAKyB,WADpB,CAEE,MAAM,CAAE,KAAKrK,KAAL,CAAWiK,MAFrB,CAGE,WAAW,CAAE,KAAKjK,KAAL,CAAW+H,gBAH1B,CAIE,YAAY,CAAE,KAAK/H,KAAL,CAAWgI,aAJ3B,EApBF,cA2BE,oBAAC,UAAD,EACE,UAAU,CAAE,KAAKnI,UADnB,CAEE,UAAU,CAAE,KAAKO,UAFnB,CAGE,QAAQ,CAAE,KAAKwD,QAHjB,CAIE,MAAM,CAAE,wBAAM,CAAA,MAAI,CAACiB,MAAL,CAAY,IAAZ,CAAN,EAJV,CAKE,OAAO,CAAE,KAAK7E,KAAL,CAAW6H,OALtB,CAME,MAAM,CAAE,KAAK7H,KAAL,CAAW8H,MANrB,CAOE,IAAI,CAAE,KAAKW,IAPb,CAQE,SAAS,CAAE,KAAKG,SARlB,CASE,YAAY,CAAE,KAAK5I,KAAL,CAAWwB,iBAT3B,CAUE,WAAW,CAAE,KAAKxB,KAAL,CAAWuB,gBAV1B,CAWE,aAAa,CAAE,KAAKvB,KAAL,CAAW+B,kBAX5B,CAYE,WAAW,CAAE,KAAK/B,KAAL,CAAW+D,gBAZ1B,CAaE,UAAU,CAAE,KAAKpE,KAAL,CAAWqE,UAbzB,EA3BF,cA0CE,oBAAC,MAAD,MA1CF,CADF,CA8CD,C,uBAniBqBzF,S,EAsiBxB,cAAemB,CAAAA,SAAf","sourcesContent":["import React, { Component } from \"react\";\r\nimport Video from \"../partial/video/Video\";\r\nimport VidButtons from \"../partial/video/VidButtons\";\r\nimport Chat from \"../partial/chat/Chat\";\r\nimport \"./VideoPage.css\";\r\nimport firebase from \"../../../config/Firebase\"\r\nimport Credit from \"../partial/credit/Credit\"\r\n\r\nconst configuration = { // determine internet configuation\r\n  iceServers: [\r\n    {\r\n      urls: ['stun:stun1.l.google.com:19302', 'stun:stun2.l.google.com:19302'],\r\n    }\r\n  ],\r\n  iceCandidatePoolSize: 10,\r\n};\r\n\r\nconst constraints = {\r\n  audio: true,\r\n  video: {\r\n    width: { ideal: 1920 },\r\n    height: { ideal: 1080 }\r\n  }\r\n};\r\n\r\nconst localVideo = React.createRef();\r\n\r\nconst remoteVideo = React.createRef();\r\n\r\nclass VideoPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      localStream: null,\r\n      remoteStream: null,\r\n      localPeer: null,\r\n      roomId: \"\",\r\n      localChannel: null,\r\n      remoteChannel: null,\r\n      start_btn_disable: false,\r\n      hang_btn_disable: true,\r\n      create_btn_disable: false,\r\n      join_btn_disable: false,\r\n      send_btn_disable: true,\r\n      input_disable: true,\r\n      fullScreen: true,\r\n      muteVis: \"hidden\",\r\n      vidVis: \"hidden\",\r\n      isStarted: false,\r\n      isConnected: false,\r\n      isFinished: false,\r\n      readyToJoin: false,\r\n      timer: [0, 0, 0, 0, 0],\r\n      intervalFunc: null,\r\n      timeoutChecking: null,\r\n      timeoutDisconnected: null,\r\n      outMes: { mes: \"\" },\r\n      disconFlag: false,\r\n      checkFlag: false,\r\n      firstSnapShot: null,\r\n      secondSnapShot: null,\r\n      firstTimeDirect: true,\r\n      mute_icon: \"black\",\r\n      video_icon: \"black\",\r\n      rem_mute_icon: \"black\",\r\n      rem_video_icon: \"black\"\r\n    }\r\n    this.usersRef = firebase.firestore().collection('Users');\r\n  }\r\n\r\n  startVideoDirectly = () => { // auto video start\r\n    this.startVideo();\r\n    var checkIfStartedStream = setInterval(() => {\r\n      if (this.state.localStream && this.state.remoteStream) {\r\n        if (this.props.hostVid)\r\n          this.createRoom();\r\n        else\r\n          this.joinRoomById(this.props.room_id);\r\n        clearInterval(checkIfStartedStream)\r\n      }\r\n    }, 200);\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.props.directVid && (this.props.room_id !== \"\" || this.props.hostVid))\r\n      this.startVideoDirectly();\r\n  }\r\n\r\n  componentWillUnmount(event) {\r\n    if (this.state.isStarted)\r\n      this.hangUp(false, false);\r\n  }\r\n\r\n  componentDidUpdate(prevProp) {\r\n    if (this.props.directVid !== prevProp.directVid)\r\n      if (this.props.directVid)\r\n        this.startVideoDirectly();\r\n  }\r\n\r\n  startVideo = async () => {\r\n    navigator.mediaDevices.getUserMedia(constraints)\r\n      .then(stream => {\r\n        console.log(\"Chrome has received your local stream successfully\\nUsing video device: \" +\r\n          stream.getVideoTracks()[0].label + \"\\nUsing audio device: \" + stream.getAudioTracks()[0].label);\r\n        this.setState({ remoteStream: new MediaStream() }, () => {\r\n          remoteVideo.current.srcObject = this.state.remoteStream;\r\n        });\r\n        this.setState({ localStream: stream }, async () => {\r\n          localVideo.current.srcObject = this.state.localStream;\r\n          this.setState({\r\n            isStarted: true,\r\n            hang_btn_disable: false, start_btn_disable: true\r\n          });\r\n          this.props.modifyVideoStream(); // modifing app about a new video stream\r\n        });\r\n      })\r\n      .catch(e => {\r\n        alert(e.name);\r\n        this.props.modifyVideoNotAllowed();\r\n      });\r\n  }\r\n\r\n  createRoom = async () => {\r\n    if (!this.state.isStarted) {\r\n      alert(\"אנא לחץ על כפתור 'התחל שיחת וידאו'\")\r\n      return;\r\n    }\r\n\r\n    this.setState({ create_btn_disable: true })\r\n\r\n    this.setState({ localPeer: new RTCPeerConnection(configuration) }, async () => {   // create local peer\r\n      console.log(\"Created local peer\");\r\n      this.getMediaTracks();\r\n      this.getRemoteMediaTracks();\r\n      this.handleDataChannel('first_channel');\r\n\r\n\r\n      const offer = await this.state.localPeer.createOffer(); // creating offer request\r\n\r\n      const roomOffer = {\r\n        offer: {\r\n          type: offer.type,\r\n          sdp: offer.sdp\r\n        }\r\n      }\r\n\r\n      const roomRef = await this.usersRef\r\n        .doc(this.props.linkId)\r\n        .collection('Rooms')\r\n        .add(roomOffer);\r\n\r\n      this.connectionHandler(roomRef, 'first_participant', 'second_participant'); // handle internet connection (based on ICE protocol)\r\n      try {\r\n        await this.state.localPeer.setLocalDescription(offer);\r\n      }\r\n      catch (e) {\r\n        console.log(e.name);\r\n      }\r\n      var firstSnap = roomRef.onSnapshot(async snapshot => { // waiting for an answer\r\n        const data = snapshot.data();\r\n        try {\r\n          if (!this.state.localPeer.currentRemoteDescription && typeof (data.answer) !== 'undefined') {\r\n            console.log(`Got update room is ${snapshot.id}`)\r\n            console.log(`Set remote description: ${data.answer}`);\r\n            const answer = new RTCSessionDescription(data.answer);\r\n            console.log(answer);\r\n            await this.state.localPeer.setRemoteDescription(answer);\r\n          }\r\n        }\r\n        catch (e) {\r\n          console.log(e.name);\r\n        }\r\n      });\r\n      this.setState({ firstSnapShot: firstSnap });\r\n    });\r\n  }\r\n\r\n  joinRoom = (guestId) => { // For joining a room with entering friend's room ID as an input (optional) \r\n    if (!this.state.isStarted) {\r\n      alert(\"אנא לחץ על כפתור 'התחל שיחה'\")\r\n      return;\r\n    }\r\n    if (guestId === \"\") {\r\n      alert(\"אנא הכנס את מספר החדר של החניך/חונך\");\r\n      return;\r\n    }\r\n    this.joinRoomById(guestId);\r\n  }\r\n\r\n  joinRoomById = async (roomIdOfGuest) => {\r\n    this.setState({\r\n      create_btn_disable: true,\r\n      join_btn_disable: true\r\n    });\r\n    console.log(`You want to join room ${roomIdOfGuest}`);\r\n    if (roomIdOfGuest === \"\") {\r\n      alert(this.props.linkedName + \" ביטל את השיחה\");\r\n      document.location.reload(true);\r\n      return;\r\n    }\r\n\r\n    const roomRef = this.usersRef\r\n      .doc(this.props.myLinkId)\r\n      .collection('Rooms')\r\n      .doc(`${roomIdOfGuest}`);\r\n    const roomSnap = await roomRef.get();\r\n    console.log(`Room existance in DB: ${roomSnap.exists}`);\r\n\r\n    if (!roomSnap.exists) {\r\n      alert(\"החדר לא קיים במערכת. נסה שוב.\");\r\n      this.setState({\r\n        create_btn_disable: false,\r\n        join_btn_disable: false\r\n      })\r\n      return;\r\n    }\r\n    this.setState({ readyToJoin: true, roomId: \"מספר החדר שלך הינו: \" + roomRef.id });\r\n    console.log(`Creating peer connection with the configuration: ${configuration}`);\r\n    this.setState({ localPeer: new RTCPeerConnection(configuration) }, async () => {\r\n      console.log(\"Created local peer\");\r\n      this.getMediaTracks();\r\n      this.getRemoteMediaTracks();\r\n      this.handleDataChannel('second_channel');\r\n\r\n      this.connectionHandler(roomRef, 'second_participant', 'first_participant'); // handle internet connection (based on ICE protocol)\r\n\r\n      const offer = roomSnap.data().offer;\r\n      console.log(\"created offer\");\r\n      await this.state.localPeer.setRemoteDescription(offer);\r\n      const answer = await this.state.localPeer.createAnswer();\r\n      await this.state.localPeer.setLocalDescription(answer);\r\n      const roomAnswer = {\r\n        answer: {\r\n          type: answer.type,\r\n          sdp: answer.sdp\r\n        }\r\n      }\r\n      await roomRef.update(roomAnswer);\r\n    });\r\n  }\r\n\r\n  hangUp = (val, willReload = true) => {\r\n    var isConfirmed;\r\n    if (!val)\r\n      isConfirmed = true;\r\n    else\r\n      isConfirmed = window.confirm(\"האם אתה בטוח שברצונך לסיים את השיחה?\");\r\n    if (isConfirmed) {\r\n      this.setState({ isFinished: true });\r\n      if (this.state.localChannel && this.state.localChannel.readyState === 'open' &&\r\n        this.state.remoteChannel && (val || !willReload))\r\n        this.state.localChannel.send(JSON.stringify({ finish: true }))\r\n      if (this.state.firstSnapShot !== null)\r\n        this.state.firstSnapShot();\r\n      if (this.state.secondSnapShot !== null)\r\n        this.state.secondSnapShot();\r\n      clearInterval(this.state.intervalFunc);\r\n      this.state.localStream.getTracks().forEach(track => track.stop());\r\n      console.log(\"Closed local tracks\")\r\n      if (this.state.remoteStream) {\r\n        this.state.remoteStream.getTracks().forEach(track => track.stop());\r\n        console.log(\"Closed remote tracks\")\r\n      }\r\n      if (val && willReload && this.state.isConnected)\r\n        alert(\"סיימת את השיחה. זמן השיחה: \" +\r\n          this.state.timer[0] + \":\" + this.state.timer[1] + \"\" +\r\n          this.state.timer[2] + \":\" + this.state.timer[3] + \"\" +\r\n          this.state.timer[4]);\r\n      else if (!val && willReload && this.state.isConnected)\r\n        alert(\"זמן השיחה: \" +\r\n          this.state.timer[0] + \":\" + this.state.timer[1] + \"\" +\r\n          this.state.timer[2] + \":\" + this.state.timer[3] + \"\" +\r\n          this.state.timer[4]);\r\n      if (this.state.localPeer !== null) {\r\n        this.state.localPeer.close();\r\n        console.log(\"Closed local peer\")\r\n      }\r\n      this.setState({ localPeer: null });\r\n      if (willReload) {\r\n        setTimeout(() => {\r\n          document.location.reload(true);\r\n        }, 500);\r\n      }\r\n      else\r\n        this.props.removeDocs();\r\n    }\r\n  }\r\n\r\n  connectionHandler = async (roomRef, localName, remoteName) => { // handle internet connection\r\n    const candidateCol = roomRef.collection(localName);\r\n    try {\r\n      this.state.localPeer.addEventListener('icecandidate', event => {\r\n        if (event.candidate) {\r\n          const jsonData = event.candidate.toJSON();\r\n          candidateCol.add(jsonData);\r\n        }\r\n      });\r\n    }\r\n    catch (e) {\r\n      console.log(e.name)\r\n    }\r\n    try {\r\n      this.state.localPeer.onconnectionstatechange = this.onIceChanged;\r\n    }\r\n    catch (e) {\r\n      console.log(e.name)\r\n    }\r\n    var secondSnap = roomRef.collection(remoteName).onSnapshot(snapshot => {\r\n      snapshot.docChanges().forEach(change => {\r\n        if (change.type === \"added\" || change.doc.data()) {\r\n          const candidate = new RTCIceCandidate(change.doc.data());\r\n          this.state.localPeer.addIceCandidate(candidate);\r\n          console.log(`candidate success`);\r\n        }\r\n      });\r\n    });\r\n    this.setState({ secondSnapShot: secondSnap });\r\n  }\r\n\r\n  onIceChanged = (e) => { // internet connection change event\r\n    var currStat = e.target;\r\n    console.log(`ICE connection state changed: ${currStat.iceConnectionState}`);\r\n    if (currStat.iceConnectionState === \"connected\" && !this.state.isConnected) // first time connection\r\n      this.onCandidateConnected();\r\n    else if (currStat.iceConnectionState === \"connected\" && this.state.isConnected) // reconnection\r\n      this.onReconnection();\r\n    else if (currStat.iceConnectionState === \"disconnected\" && this.state.isConnected) // disconnecction after connection\r\n      this.onCandidateDisconnected();\r\n    else if ((currStat.iceConnectionState === \"disconnected\" || currStat.iceConnectionState === \"checking\")\r\n      && !this.state.isConnected) // disconnection before connection\r\n      this.onCandidateChecking();\r\n  };\r\n\r\n  mateDisconnected = () => {\r\n    clearInterval(this.state.intervalFunc);\r\n    alert(this.props.linkedName + \" סיים את השיחה.\");\r\n    this.hangUp(false);\r\n  }\r\n\r\n  onCandidateConnected = () => {\r\n    console.log(\"תהליך ההתחברות הסתיים בהצלחה.\")\r\n    this.setState({\r\n      isConnected: true, muteVis: \"visible\",\r\n      vidVis: \"visible\", create_btn_disable: true,\r\n      join_btn_disable: true, send_btn_disable: false,\r\n      input_disable: false, fullScreen: false\r\n    });\r\n    if (this.state.intervalFunc === null)\r\n      this.setState({ intervalFunc: setInterval(this.intervalFunc, 1000) });\r\n  }\r\n\r\n  unavailableConnection = () => {\r\n    clearTimeout(this.setState.timeoutDisconnected);\r\n    var iceConnectionState = this.state.localPeer.iceConnectionState;\r\n    if (iceConnectionState === \"disconnected\" || iceConnectionState === \"checking\") {\r\n      clearInterval(this.state.intervalFunc);\r\n      alert(this.props.linkedName + \" חווה בעיית אינטרנט. נסו שוב מאוחר יותר.\");\r\n      this.hangUp(false);\r\n    }\r\n  }\r\n\r\n  onReconnection = () => {\r\n    this.setState({ disconFlag: false });\r\n  }\r\n\r\n  onCandidateDisconnected = () => {\r\n    if (!this.state.disconFlag) {\r\n      this.setState({\r\n        timeoutDisconnected: setTimeout(this.unavailableConnection, 15000),\r\n        disconFlag: true\r\n      });\r\n    }\r\n  }\r\n\r\n  checkCon = () => {\r\n    clearTimeout(this.state.timeoutChecking);\r\n    if (!this.state.isConnected) {\r\n      clearInterval(this.state.intervalFunc);\r\n      alert(\"תהליך ההתחברות נכשל. אנא נסה שוב בעוד מספר דקות.\");\r\n      this.hangUp(false);\r\n    }\r\n    else\r\n      this.setState({ checkFlag: false });\r\n  }\r\n\r\n  onCandidateChecking = () => {\r\n    if (!this.state.checkFlag)\r\n      this.setState({\r\n        timeoutChecking: setTimeout(this.checkCon, 10000),\r\n        checkFlag: true, readyToJoin: true\r\n      });\r\n  }\r\n\r\n  intervalFunc = () => {\r\n    if (this.state.timer[4] !== 9)\r\n      this.setState({\r\n        timer: [this.state.timer[0],\r\n        this.state.timer[1],\r\n        this.state.timer[2],\r\n        this.state.timer[3],\r\n        this.state.timer[4] + 1]\r\n      })\r\n    else if (this.state.timer[4] === 9\r\n      && this.state.timer[3] !== 5)\r\n      this.setState({\r\n        timer: [this.state.timer[0],\r\n        this.state.timer[1],\r\n        this.state.timer[2],\r\n        this.state.timer[3] + 1, 0]\r\n      });\r\n    else if (this.state.timer[4] === 9 &&\r\n      this.state.timer[3] === 5 &&\r\n      this.state.timer[2] !== 9)\r\n      this.setState({\r\n        timer: [this.state.timer[0],\r\n        this.state.timer[1],\r\n        this.state.timer[2] + 1, 0, 0]\r\n      });\r\n    else if (this.state.timer[4] === 9 &&\r\n      this.state.timer[3] === 5 &&\r\n      this.state.timer[2] === 9 &&\r\n      this.state.timer[1] !== 5)\r\n      this.setState({\r\n        timer: [this.state.timer[0],\r\n        this.state.timer[1] + 1, 0, 0, 0]\r\n      });\r\n    else\r\n      this.setState({\r\n        timer: [this.state.timer[0] + 1, 0, 0, 0, 0]\r\n      });\r\n  }\r\n\r\n  mute = () => {\r\n    if (this.state.localStream.getAudioTracks()[0].enabled) {\r\n      this.setState({ mute_icon: \"blue\" })\r\n      this.state.localChannel.send(JSON.stringify({ mute: true }))\r\n    }\r\n    else {\r\n      this.setState({ mute_icon: \"black\" })\r\n      this.state.localChannel.send(JSON.stringify({ mute: false }))\r\n    }\r\n    this.state.localStream.getAudioTracks()[0].enabled = !(this.state.localStream.getAudioTracks()[0].enabled);\r\n  }\r\n\r\n  stopVideo = () => {\r\n    if (this.state.localStream.getVideoTracks()[0].enabled) {\r\n      this.setState({ video_icon: \"blue\" })\r\n      this.state.localChannel.send(JSON.stringify({ video: true }))\r\n    }\r\n    else {\r\n      this.setState({ video_icon: \"black\" })\r\n      this.state.localChannel.send(JSON.stringify({ video: false }))\r\n    }\r\n    this.state.localStream.getVideoTracks()[0].enabled = !(this.state.localStream.getVideoTracks()[0].enabled);\r\n  }\r\n\r\n  handleDataChannel = async (dataChannelName) => {\r\n    //creating data channel\r\n    const dataPar = { ordered: true };\r\n    this.setState({ localChannel: this.state.localPeer.createDataChannel(dataChannelName, dataPar) },\r\n      () => {\r\n        this.state.localChannel.binaryType = 'arraybuffer';\r\n        this.state.localChannel.onopen = this.openDataChannel;\r\n        this.state.localChannel.onclose = this.closedDataChannel;\r\n        this.state.localPeer.ondatachannel = this.remoteOpenDataChannel;\r\n      });\r\n  }\r\n\r\n  getMediaTracks = async () => {\r\n    if (typeof (this.state.localStream) !== 'undefined') {\r\n      this.state.localStream.getTracks()\r\n        .forEach(track => this.state.localPeer\r\n          .addTrack(track, this.state.localStream));\r\n      console.log(\"Local stream has added to peer\");\r\n    }\r\n  }\r\n\r\n  getRemoteMediaTracks = async () => {\r\n    this.state.localPeer.addEventListener('track', event => {\r\n      console.log(`Got remote track: ${event.streams[0]}`);\r\n      event.streams[0].getTracks().forEach(track => {\r\n        console.log(`Added track to the remote stream: ${track}`);\r\n        this.state.remoteStream.addTrack(track);\r\n      });\r\n    });\r\n  }\r\n\r\n  openDataChannel = async () => {\r\n    console.log(\"Local channel has opened\");\r\n  }\r\n\r\n  closedDataChannel = async () => {\r\n    console.log(\"Local channel has closed\");\r\n    if (this.state.isConnected && !this.state.isFinished)\r\n      alert(\"סיימת את השיחה. זמן השיחה: \" +\r\n        this.state.timer[0] + \":\" + this.state.timer[1] + \"\" +\r\n        this.state.timer[2] + \":\" + this.state.timer[3] + \"\" +\r\n        this.state.timer[4]);\r\n  }\r\n\r\n  remoteOpenDataChannel = async (event) => {\r\n    event.preventDefault();\r\n    this.setState({ remoteChannel: event.channel }, () => {\r\n      this.state.remoteChannel.onmessage = this.getMessage;\r\n    });\r\n  }\r\n\r\n  getMessage = async (event) => {\r\n    event.preventDefault();\r\n    var newMessage = JSON.parse(event.data);\r\n    if (typeof (newMessage) === 'string')\r\n      this.setState({ outMes: { mes: newMessage } });\r\n    else if (newMessage.finish === true)\r\n      this.setState({ isFinished: true }, this.mateDisconnected());\r\n    else if (newMessage.mute === true)\r\n      this.setState({ rem_mute_icon: \"blue\" });\r\n    else if (newMessage.mute === false)\r\n      this.setState({ rem_mute_icon: \"black\" });\r\n    else if (newMessage.video === true)\r\n      this.setState({ rem_video_icon: \"blue\" });\r\n    else if (newMessage.video === false)\r\n      this.setState({ rem_video_icon: \"black\" });\r\n  }\r\n\r\n  sendMessage = async (message) => {\r\n    this.state.localChannel.send(JSON.stringify(message));\r\n    console.log(\"The message was sent: \" + message);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"main-vid-page\" >\r\n\r\n        <Video\r\n          localRef={localVideo}\r\n          remoteRef={remoteVideo}\r\n          timer={this.state.timer}\r\n          fullScreenDisable={this.state.fullScreen}\r\n          userName={this.props.userName}\r\n          linkedName={this.props.linkedName}\r\n          isConnected={this.state.isConnected}\r\n          readyToJoin={this.state.readyToJoin}\r\n          disconnectionStat={this.state.disconFlag}\r\n          mute_icon={this.state.mute_icon}\r\n          video_icon={this.state.video_icon}\r\n          rem_mute_icon={this.state.rem_mute_icon}\r\n          rem_video_icon={this.state.rem_video_icon}\r\n          mute_func={this.mute}\r\n          stop_vid_func={this.stopVideo}\r\n        />\r\n\r\n        <Chat\r\n          sendMessage={this.sendMessage}\r\n          outMes={this.state.outMes}\r\n          sendDisable={this.state.send_btn_disable}\r\n          inputDisable={this.state.input_disable}\r\n        />\r\n\r\n        <VidButtons\r\n          startVideo={this.startVideo}\r\n          createRoom={this.createRoom}\r\n          joinRoom={this.joinRoom}\r\n          hangUp={() => this.hangUp(true)}\r\n          muteVis={this.state.muteVis}\r\n          vidVis={this.state.vidVis}\r\n          mute={this.mute}\r\n          stopVideo={this.stopVideo}\r\n          startDisable={this.state.start_btn_disable}\r\n          hangDisable={this.state.hang_btn_disable}\r\n          createDisable={this.state.create_btn_disable}\r\n          joinDisable={this.state.join_btn_disable}\r\n          linkedName={this.props.linkedName}\r\n        />\r\n        <Credit />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default VideoPage;\r\n"]},"metadata":{},"sourceType":"module"}