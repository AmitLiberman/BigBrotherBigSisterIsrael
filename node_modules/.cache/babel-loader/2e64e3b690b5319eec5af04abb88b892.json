{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\ahmad\\\\Downloads\\\\BigBrotherBigSisterIsrael-master\\\\BigBrotherBigSisterIsrael-master\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import*as React from\"react\";import\"./WallPost.css\";import{Post}from\"./post/Post\";import AddPicture from\"./AddPicture\";import firebase from\"../../../config/Firebase\";import Loader from'react-loader-spinner';var WallPost=/*#__PURE__*/function(_React$Component){_inherits(WallPost,_React$Component);var _super=_createSuper(WallPost);function WallPost(){var _this;_classCallCheck(this,WallPost);_this=_super.call(this);_this.getPosts=function(){var postsRef;var copyArray=[];_this.usersRef.doc(_this.userUid).get().then(function(doc){if(doc.data().type==='חונך')postsRef=doc.ref.collection('Posts');else if(doc.data().type==='חניך')postsRef=_this.usersRef.doc(doc.data().link_user).collection('Posts');}).then(function(){postsRef.orderBy('timeStamp','desc').limit(5).get().then(function(docs){_this.setState({lastPostVisible:docs.docs[docs.docs.length-1]},function(){if(docs.empty)_this.setState({lastPostVisible:{timeStamp:Date.now()/1000-7200}});else if(typeof _this.state.lastPostVisible==='undefined')_this.setState({loadedAll:true});});var ind=0;docs.forEach(function(doc){_this.setState({currId:_this.postID+1});_this.postID=_this.postID+1;var images=[];_this.cloudRef.child('wall_pictures/'+doc.id).list().then(function(pics){pics.items.forEach(function(pic,index){pic.getDownloadURL().then(function(url){images.splice(index,0,url);if(images.length===pics.items.length){var uploadedPostObj={id:_this.postID,body:doc.data().text,img:images,timeStamp:doc.data().timeStamp,uploader:doc.data().uploader,doc_id:doc.id};Object.assign(copyArray,_this.state.postArray);copyArray.splice(ind,0,uploadedPostObj);copyArray.sort(function(a,b){return _this.sortFunc(a,b);});_this.setState({postArray:[].concat(copyArray)});}});});});if(!doc.data().img){var uploadedPostObj={id:_this.postID,body:doc.data().text,img:[],timeStamp:doc.data().timeStamp,uploader:doc.data().uploader,doc_id:doc.id};Object.assign(copyArray,_this.state.postArray);copyArray.splice(ind,0,uploadedPostObj);copyArray.sort(function(a,b){return _this.sortFunc(a,b);});_this.setState({postArray:[].concat(copyArray)});}ind++;});});}).catch(function(e){return console.log(e.name);});};_this.readNewmessages=function(){var linkUser;var postsRef;_this.usersRef.doc(_this.userUid).get().then(function(doc){if(doc.data().type==='חונך')postsRef=doc.ref.collection('Posts');else if(doc.data().type==='חניך')postsRef=_this.usersRef.doc(doc.data().link_user).collection('Posts');linkUser=doc.data().link_user;}).then(function(){postsRef.where('uploader','==',linkUser).where('unread','==',true).get().then(function(docs){return docs.forEach(function(doc){return doc.ref.update({unread:false});});});}).catch(function(e){return console.log(e.name);});};_this.sortFunc=function(a,b){if(a.timeStamp>b.timeStamp)return 1;if(a.timeStamp<b.timeStamp)return-1;return 0;};_this.deleteEvent=function(index,doc_id){var con=window.confirm(\"האם אתה בטוח שברצונך למחוק את הפוסט?\");if(!con)return;var postsRef;_this.usersRef.doc(_this.userUid).get().then(function(doc){if(doc.data().type==='חונך')postsRef=doc.ref.collection('Posts');else if(doc.data().type==='חניך')postsRef=_this.usersRef.doc(doc.data().link_user).collection('Posts');}).then(function(){postsRef.doc(doc_id).delete();var picLen;_this.cloudRef.child(\"wall_pictures/\"+doc_id).list().then(function(list){return picLen=list.items.length;}).then(function(){for(var i=0;i<picLen;i++){_this.cloudRef.child(\"wall_pictures/\"+doc_id+\"/pic\"+i).delete().then(function(){return console.log(\"Post has deleted successfully\");}).catch(function(e){return console.log(e.name);});}}).catch(function(e){return console.log(e.name);});}).catch(function(e){return console.log(e.name);});var copyPostArray=Object.assign([],_this.state.postArray);copyPostArray.splice(index,1);_this.setState({postArray:copyPostArray});};_this.setPost=function(element){element.preventDefault();_this.Body=_this.state.textInput;_this.Image=[];_this.setState({textInput:element.target.value});};_this.setPicText=function(text){_this.setState({textPictureInput:text});_this.Body=_this.state.textPictureInput;};_this.setImagePost=function(pictures,url){_this.ImageFiles=pictures;_this.Image=url;_this.Body=_this.state.textPictureInput;_this.setState({textPictureInput:\"\"});_this.addPost();};_this.addPost=function(){if(_this.state.textInput===\"\"&&_this.state.textPictureInput===\"\"&&_this.Image.length===0){alert(\"יש להכניס טקסט ליצירת פרסום\");return;}if(_this.state.uploadedPost)return;_this.setState({uploadedPost:true});var postDocId;var postObj={uploader:_this.userUid,timeStamp:Date.now(),text:_this.Body,img:_this.Image.length!==0,unread:true};var postsRef;_this.usersRef.doc(_this.userUid).get().then(function(doc){if(doc.data().type==='חונך')postsRef=doc.ref.collection('Posts');else if(doc.data().type==='חניך')postsRef=_this.usersRef.doc(doc.data().link_user).collection('Posts');postsRef.add(postObj).then(function(doc){postDocId=doc.id;_this.setState({currId:_this.postID+1});_this.postID=_this.postID+1;var copyPostArray=Object.assign([],_this.state.postArray);copyPostArray.push({id:_this.postID,body:_this.Body,img:_this.Image,timeStamp:Date.now(),uploader:_this.userUid,doc_id:postDocId});_this.setState({postArray:copyPostArray});}).then(function(){for(var i=0;i<_this.ImageFiles.length;i++){if(postObj.img)var a=_this.cloudRef.child(\"wall_pictures/\"+postDocId+\"/pic\"+i).put(_this.ImageFiles[i]);try{a.on('state_changed',function(snapshot){_this.setState({uploadProgress:snapshot.bytesTransferred/snapshot.totalBytes*100});});}catch(e){console.log(e.name);}}}).then(function(){_this.setState({textInput:\"\"});_this.body=\"\";_this.Image=[];_this.setState({uploadedPost:false});_this.ImageFiles=[];});}).catch(function(e){return console.log(e.name);});};_this.AddPic=function(){_this.setState({showPicForm:true});};_this.callbackForm=function(formData){_this.setState({showPicForm:formData});};_this.loadMorePosts=function(){if(typeof _this.state.lastPostVisible==='undefined'||_this.state.lastPostVisible===null)return;var startFrom;var copyArray=[];if(typeof _this.state.lastPostVisible.timeStamp==='undefined')startFrom=_this.state.lastPostVisible.data().timeStamp;else startFrom=_this.state.lastPostVisible.timeStamp;_this.setState({loadingPastPosts:true});var postsRef;_this.usersRef.doc(_this.userUid).get().then(function(doc){if(doc.data().type==='חונך')postsRef=doc.ref.collection('Posts');else if(doc.data().type==='חניך')postsRef=_this.usersRef.doc(doc.data().link_user).collection('Posts');}).then(function(){postsRef.orderBy(\"timeStamp\",\"desc\").startAfter(startFrom).limit(5).get().then(function(querySnap){if(querySnap.docs.length<5)_this.setState({loadedAll:true});if(querySnap.docs.length===0)return;_this.setState({lastPostVisible:querySnap.docs[querySnap.docs.length-1]});var ind=0;querySnap.forEach(function(doc){_this.setState({currId:_this.postID+1});_this.postID=_this.postID+1;var images=[];_this.cloudRef.child('wall_pictures/'+doc.id).list().then(function(pics){pics.items.forEach(function(pic,index){pic.getDownloadURL().then(function(url){images.splice(index,0,url);if(images.length===pics.items.length){var uploadedPostObj={id:_this.postID,body:doc.data().text,img:images,timeStamp:doc.data().timeStamp,uploader:doc.data().uploader,doc_id:doc.id};Object.assign(copyArray,_this.state.postArray);copyArray.splice(ind,0,uploadedPostObj);copyArray.sort(function(a,b){return _this.sortFunc(a,b);});_this.setState({postArray:[].concat(copyArray)});}});});});if(!doc.data().img){var uploadedPostObj={id:_this.postID,body:doc.data().text,img:[],timeStamp:doc.data().timeStamp,uploader:doc.data().uploader,doc_id:doc.id};Object.assign(copyArray,_this.state.postArray);copyArray.splice(ind,0,uploadedPostObj);copyArray.sort(function(a,b){return _this.sortFunc(a,b);});_this.setState({postArray:[].concat(copyArray)});}ind++;});}).then(function(){return _this.setState({loadingPastPosts:false});}).catch(function(e){return console.log(e.name);});});};_this.showPicForm=false;_this.postID=0;_this.Body=\"\";_this.Image=[];_this.ImageFiles=[];_this.state={postArray:[],textInput:\"\",textPictureInput:\"\",uploadProgress:0,currId:0,lastPostVisible:null,loadedAll:false,loadingPastPosts:false,uploadedPost:false};_this.usersRef=firebase.firestore().collection('Users');_this.cloudRef=firebase.storage().ref();_this.userUid=firebase.auth().currentUser.uid;return _this;}_createClass(WallPost,[{key:\"componentDidMount\",value:function componentDidMount(){this.readNewmessages();this.getPosts();}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/ (/* Page Container*/React.createElement(\"div\",{className:\"page-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"wall-post-main\"},/*#__PURE__*/React.createElement(\"div\",{className:\"wall-new-post\"},/*#__PURE__*/React.createElement(\"div\",{className:\"wall-post-top\"},\"\\u05E6\\u05D5\\u05E8 \\u05E4\\u05E8\\u05E1\\u05D5\\u05DD\"),/*#__PURE__*/React.createElement(\"div\",{className:\"wall-post-tip\"},\"(\\u05DC\\u05E4\\u05EA\\u05D9\\u05D7\\u05EA \\u05D7\\u05DC\\u05D5\\u05E0\\u05D9\\u05EA \\u05D0\\u05D9\\u05DE\\u05D5\\u05D2'\\u05D9 \\u05E9\\u05DC \\u05D4\\u05D3\\u05E4\\u05D3\\u05E4\\u05DF \\u05DC\\u05D7\\u05E5 \\u05E2\\u05DC \\u05DE\\u05E7\\u05E9 \\u05E0\\u05E7\\u05D5\\u05D3\\u05D4 (./\\u05E5) \\u05D5\\u05E2\\u05DC \\u05DE\\u05E7\\u05E9 Windows \\u05D9\\u05D7\\u05D3\\u05D9\\u05D5)\"),/*#__PURE__*/React.createElement(\"div\",{className:\"wall-post-mid\"},/*#__PURE__*/React.createElement(\"input\",{className:\"form-control\",type:\"text\",onBlur:this.setPost,placeholder:\"\\u05DB\\u05EA\\u05D5\\u05D1 \\u05E4\\u05E8\\u05E1\\u05D5\\u05DD..\",value:this.state.textInput,onChange:function onChange(e){return _this2.setState({textInput:e.target.value});}})),/*#__PURE__*/React.createElement(\"div\",{className:\"wall-post-footer\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-success wall-post-b-a\",onClick:this.AddPic},\"\\u05E6\\u05E8\\u05E3 \\u05EA\\u05DE\\u05D5\\u05E0\\u05D4\"),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-success wall-post-b-p\",onClick:this.addPost},\"\\u05E4\\u05E8\\u05E1\\u05DD\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"wall-post-list\"},this.state.postArray.map(function(post,index){return/*#__PURE__*/React.createElement(Post,{myProfilePic:_this2.props.myProfilePic,friendProfilePic:_this2.props.friendProfilePic,userName:_this2.props.userName,friendName:_this2.props.friendName,key:\"post\"+index,id:post.id,body:post.body,img:post.img,doc_id:post.doc_id,timeStamp:post.timeStamp,uploader:post.uploader,delete:_this2.deleteEvent.bind(_this2,index,post.doc_id),uploadProgress:_this2.state.uploadProgress,currId:_this2.state.currId});}).reverse()),/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary load-more-posts\",disabled:this.state.loadedAll,onClick:this.loadMorePosts},\"\\u05D8\\u05E2\\u05DF \\u05E4\\u05D5\\u05E1\\u05D8\\u05D9\\u05DD \\u05E0\\u05D5\\u05E1\\u05E4\\u05D9\\u05DD\"),/*#__PURE__*/React.createElement(Loader,{className:\"loader-past-posts\",type:\"TailSpin\",height:\"30px\",width:\"30px\",color:\"royalblue\",visible:this.state.loadingPastPosts})),this.state.showPicForm?/*#__PURE__*/React.createElement(AddPicture,{parentCallback:this.callbackForm,setImagePostParent:this.setImagePost,setPicText:this.setPicText,showText:true}):null));}}]);return WallPost;}(React.Component);export default WallPost;","map":{"version":3,"sources":["C:/Users/ahmad/Downloads/BigBrotherBigSisterIsrael-master/BigBrotherBigSisterIsrael-master/src/navBarComponents/wallComponents/wall/WallPost.jsx"],"names":["React","Post","AddPicture","firebase","Loader","WallPost","getPosts","postsRef","copyArray","usersRef","doc","userUid","get","then","data","type","ref","collection","link_user","orderBy","limit","docs","setState","lastPostVisible","length","empty","timeStamp","Date","now","state","loadedAll","ind","forEach","currId","postID","images","cloudRef","child","id","list","pics","items","pic","index","getDownloadURL","url","splice","uploadedPostObj","body","text","img","uploader","doc_id","Object","assign","postArray","sort","a","b","sortFunc","catch","e","console","log","name","readNewmessages","linkUser","where","update","unread","deleteEvent","con","window","confirm","delete","picLen","i","copyPostArray","setPost","element","preventDefault","Body","textInput","Image","target","value","setPicText","textPictureInput","setImagePost","pictures","ImageFiles","addPost","alert","uploadedPost","postDocId","postObj","add","push","put","on","snapshot","uploadProgress","bytesTransferred","totalBytes","AddPic","showPicForm","callbackForm","formData","loadMorePosts","startFrom","loadingPastPosts","startAfter","querySnap","firestore","storage","auth","currentUser","uid","map","post","props","myProfilePic","friendProfilePic","userName","friendName","bind","reverse","Component"],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport \"./WallPost.css\";\r\nimport { Post } from \"./post/Post\";\r\nimport AddPicture from \"./AddPicture\";\r\nimport firebase from \"../../../config/Firebase\"\r\nimport Loader from 'react-loader-spinner'\r\n\r\nclass WallPost extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.showPicForm = false;\r\n    this.postID = 0;\r\n    this.Body = \"\";\r\n    this.Image = [];\r\n    this.ImageFiles = [];\r\n    this.state = {\r\n      postArray: [],\r\n      textInput: \"\",\r\n      textPictureInput: \"\",\r\n      uploadProgress: 0,\r\n      currId: 0,\r\n      lastPostVisible: null,\r\n      loadedAll: false,\r\n      loadingPastPosts: false,\r\n      uploadedPost: false\r\n    };\r\n    this.usersRef = firebase.firestore().collection('Users');\r\n    this.cloudRef = firebase.storage().ref();\r\n    this.userUid = firebase.auth().currentUser.uid;\r\n  }\r\n\r\n  getPosts = () => {\r\n    var postsRef;\r\n    var copyArray = [];\r\n    this.usersRef.doc(this.userUid).get()\r\n      .then(doc => {\r\n        if (doc.data().type === 'חונך')\r\n          postsRef = doc.ref.collection('Posts');\r\n        else if (doc.data().type === 'חניך')\r\n          postsRef = this.usersRef.doc(doc.data().link_user).collection('Posts');\r\n      })\r\n      .then(() => {\r\n        postsRef\r\n          .orderBy('timeStamp', 'desc')\r\n          .limit(5)\r\n          .get()\r\n          .then(docs => {\r\n            this.setState({ lastPostVisible: docs.docs[docs.docs.length - 1] }, () => {\r\n              if (docs.empty)\r\n                this.setState({ lastPostVisible: { timeStamp: ((Date.now() / 1000) - 7200) } })\r\n              else if (typeof (this.state.lastPostVisible) === 'undefined')\r\n                this.setState({ loadedAll: true })\r\n            });\r\n            var ind = 0;\r\n            docs.forEach((doc) => {\r\n              this.setState({ currId: this.postID + 1 });\r\n              this.postID = this.postID + 1;\r\n              var images = [];\r\n              this.cloudRef.child('wall_pictures/' + doc.id).list()\r\n                .then(pics => {\r\n                  pics.items.forEach((pic, index) => {\r\n                    pic.getDownloadURL()\r\n                      .then(url => {\r\n                        images.splice(index, 0, url)\r\n                        if (images.length === pics.items.length) {\r\n                          var uploadedPostObj = {\r\n                            id: this.postID,\r\n                            body: doc.data().text,\r\n                            img: images,\r\n                            timeStamp: doc.data().timeStamp,\r\n                            uploader: doc.data().uploader,\r\n                            doc_id: doc.id\r\n                          }\r\n                          Object.assign(copyArray, this.state.postArray);\r\n                          copyArray.splice(ind, 0, uploadedPostObj);\r\n                          copyArray.sort((a, b) => this.sortFunc(a, b));\r\n                          this.setState({\r\n                            postArray: [...copyArray]\r\n                          });\r\n                        }\r\n                      })\r\n                  })\r\n                })\r\n              if (!(doc.data().img)) {\r\n                var uploadedPostObj = {\r\n                  id: this.postID,\r\n                  body: doc.data().text,\r\n                  img: [],\r\n                  timeStamp: doc.data().timeStamp,\r\n                  uploader: doc.data().uploader,\r\n                  doc_id: doc.id\r\n                }\r\n                Object.assign(copyArray, this.state.postArray);\r\n                copyArray.splice(ind, 0, uploadedPostObj);\r\n                copyArray.sort((a, b) => this.sortFunc(a, b));\r\n                this.setState({\r\n                  postArray: [...copyArray]\r\n                });\r\n              }\r\n              ind++;\r\n            })\r\n          })\r\n      })\r\n      .catch(e => console.log(e.name));\r\n  }\r\n\r\n  readNewmessages = () => {\r\n    var linkUser;\r\n    var postsRef;\r\n    this.usersRef.doc(this.userUid).get()\r\n      .then(doc => {\r\n        if (doc.data().type === 'חונך')\r\n          postsRef = doc.ref.collection('Posts');\r\n        else if (doc.data().type === 'חניך')\r\n          postsRef = this.usersRef.doc(doc.data().link_user).collection('Posts');\r\n        linkUser = doc.data().link_user;\r\n      })\r\n      .then(() => {\r\n        postsRef\r\n          .where('uploader', '==', linkUser)\r\n          .where('unread', '==', true)\r\n          .get()\r\n          .then((docs) =>\r\n            docs.forEach((doc) => doc.ref.update({ unread: false })))\r\n      })\r\n      .catch((e) => console.log(e.name));\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.readNewmessages();\r\n    this.getPosts();\r\n  }\r\n\r\n  sortFunc = (a, b) => {\r\n    if (a.timeStamp > b.timeStamp)\r\n      return 1;\r\n    if (a.timeStamp < b.timeStamp)\r\n      return -1;\r\n    return 0;\r\n  }\r\n\r\n  /*חלון פרסום של מודעה חדשה*/\r\n  deleteEvent = (index, doc_id) => {\r\n    var con = window.confirm(\"האם אתה בטוח שברצונך למחוק את הפוסט?\");\r\n    if (!con)\r\n      return;\r\n    var postsRef;\r\n    this.usersRef.doc(this.userUid).get()\r\n      .then(doc => {\r\n        if (doc.data().type === 'חונך')\r\n          postsRef = doc.ref.collection('Posts');\r\n        else if (doc.data().type === 'חניך')\r\n          postsRef = this.usersRef.doc(doc.data().link_user).collection('Posts');\r\n      })\r\n      .then(() => {\r\n        postsRef.doc(doc_id).delete();\r\n        var picLen;\r\n        this.cloudRef.child(\"wall_pictures/\" + doc_id).list()\r\n          .then(list => picLen = list.items.length)\r\n          .then(() => {\r\n            for (let i = 0; i < picLen; i++) {\r\n\r\n              this.cloudRef.child(\"wall_pictures/\" + doc_id + \"/pic\" + i).delete()\r\n                .then(() => console.log(\"Post has deleted successfully\"))\r\n                .catch((e) => console.log(e.name));\r\n            }\r\n          })\r\n          .catch((e) => console.log(e.name));\r\n      })\r\n      .catch((e) => console.log(e.name));\r\n\r\n    const copyPostArray = Object.assign([], this.state.postArray);\r\n    copyPostArray.splice(index, 1);\r\n    this.setState({\r\n      postArray: copyPostArray,\r\n    });\r\n  };\r\n\r\n  setPost = (element) => {\r\n    element.preventDefault();\r\n\r\n    this.Body = this.state.textInput;\r\n    this.Image = [];\r\n    this.setState({ textInput: element.target.value });\r\n  };\r\n\r\n  setPicText = (text) => {\r\n    this.setState({ textPictureInput: text });\r\n    this.Body = this.state.textPictureInput;\r\n  };\r\n\r\n  setImagePost = (pictures, url) => {\r\n    this.ImageFiles = pictures;\r\n    this.Image = url;\r\n    this.Body = this.state.textPictureInput;\r\n\r\n    this.setState({ textPictureInput: \"\" });\r\n    this.addPost();\r\n  };\r\n\r\n  addPost = () => {\r\n    if (this.state.textInput === \"\" && this.state.textPictureInput === \"\" && this.Image.length === 0) {\r\n      alert(\"יש להכניס טקסט ליצירת פרסום\");\r\n      return;\r\n    }\r\n    if (this.state.uploadedPost)\r\n      return;\r\n    this.setState({ uploadedPost: true })\r\n    var postDocId;\r\n\r\n    var postObj = {\r\n      uploader: this.userUid,\r\n      timeStamp: Date.now(),\r\n      text: this.Body,\r\n      img: this.Image.length !== 0,\r\n      unread: true\r\n    }\r\n    var postsRef;\r\n    this.usersRef.doc(this.userUid).get()\r\n      .then(doc => {\r\n        if (doc.data().type === 'חונך')\r\n          postsRef = doc.ref.collection('Posts');\r\n        else if (doc.data().type === 'חניך')\r\n          postsRef = this.usersRef.doc(doc.data().link_user).collection('Posts');\r\n\r\n        postsRef\r\n          .add(postObj)\r\n          .then(doc => {\r\n            postDocId = doc.id;\r\n            this.setState({ currId: this.postID + 1 });\r\n            this.postID = this.postID + 1;\r\n            const copyPostArray = Object.assign([], this.state.postArray);\r\n            copyPostArray.push({\r\n              id: this.postID,\r\n              body: this.Body,\r\n              img: this.Image,\r\n              timeStamp: Date.now(),\r\n              uploader: this.userUid,\r\n              doc_id: postDocId\r\n            });\r\n            this.setState({\r\n              postArray: copyPostArray,\r\n            });\r\n          })\r\n          .then(() => {\r\n            for (let i = 0; i < this.ImageFiles.length; i++) {\r\n              if (postObj.img)\r\n                var a = this.cloudRef.child(\"wall_pictures/\" + postDocId + \"/pic\" + i).put(this.ImageFiles[i]);\r\n              try {\r\n                a.on('state_changed', (snapshot) => {\r\n                  this.setState({ uploadProgress: (snapshot.bytesTransferred / snapshot.totalBytes) * 100 });\r\n\r\n                })\r\n              }\r\n              catch (e) {\r\n                console.log(e.name);\r\n              }\r\n            }\r\n          })\r\n          .then(() => {\r\n            this.setState({ textInput: \"\" });\r\n            this.body = \"\";\r\n            this.Image = [];\r\n            this.setState({ uploadedPost: false });\r\n            this.ImageFiles = [];\r\n          })\r\n      })\r\n      .catch((e) => console.log(e.name));\r\n  };\r\n  /*^חלון פרסום של מודעה חדשה^*/\r\n\r\n  AddPic = () => {\r\n    this.setState({\r\n      showPicForm: true,\r\n    });\r\n  };\r\n\r\n  //the funtion that the child will active\r\n  callbackForm = (formData) => {\r\n    this.setState({ showPicForm: formData });\r\n  };\r\n\r\n  loadMorePosts = () => {\r\n    if (typeof (this.state.lastPostVisible) === 'undefined' || this.state.lastPostVisible === null)\r\n      return;\r\n    var startFrom;\r\n    var copyArray = [];\r\n    if (typeof (this.state.lastPostVisible.timeStamp) === 'undefined')\r\n      startFrom = this.state.lastPostVisible.data().timeStamp;\r\n    else\r\n      startFrom = this.state.lastPostVisible.timeStamp;\r\n    this.setState({ loadingPastPosts: true });\r\n    var postsRef;\r\n    this.usersRef.doc(this.userUid).get()\r\n      .then(doc => {\r\n        if (doc.data().type === 'חונך')\r\n          postsRef = doc.ref.collection('Posts');\r\n        else if (doc.data().type === 'חניך')\r\n          postsRef = this.usersRef.doc(doc.data().link_user).collection('Posts');\r\n      })\r\n      .then(() => {\r\n        postsRef\r\n          .orderBy(\"timeStamp\", \"desc\")\r\n          .startAfter(startFrom)\r\n          .limit(5)\r\n          .get()\r\n          .then((querySnap) => {\r\n            if (querySnap.docs.length < 5)\r\n              this.setState({ loadedAll: true })\r\n            if (querySnap.docs.length === 0)\r\n              return;\r\n            this.setState({ lastPostVisible: querySnap.docs[querySnap.docs.length - 1] });\r\n            var ind = 0;\r\n            querySnap.forEach((doc) => {\r\n              this.setState({ currId: this.postID + 1 });\r\n              this.postID = this.postID + 1;\r\n              var images = [];\r\n              this.cloudRef.child('wall_pictures/' + doc.id).list()\r\n                .then(pics => {\r\n                  pics.items.forEach((pic, index) => {\r\n                    pic.getDownloadURL()\r\n                      .then(url => {\r\n                        images.splice(index, 0, url)\r\n                        if (images.length === pics.items.length) {\r\n                          var uploadedPostObj = {\r\n                            id: this.postID,\r\n                            body: doc.data().text,\r\n                            img: images,\r\n                            timeStamp: doc.data().timeStamp,\r\n                            uploader: doc.data().uploader,\r\n                            doc_id: doc.id\r\n                          }\r\n                          Object.assign(copyArray, this.state.postArray);\r\n                          copyArray.splice(ind, 0, uploadedPostObj);\r\n                          copyArray.sort((a, b) => this.sortFunc(a, b));\r\n                          this.setState({\r\n                            postArray: [...copyArray]\r\n                          });\r\n                        }\r\n                      })\r\n                  })\r\n                })\r\n              if (!(doc.data().img)) {\r\n                var uploadedPostObj = {\r\n                  id: this.postID,\r\n                  body: doc.data().text,\r\n                  img: [],\r\n                  timeStamp: doc.data().timeStamp,\r\n                  uploader: doc.data().uploader,\r\n                  doc_id: doc.id\r\n                }\r\n                Object.assign(copyArray, this.state.postArray);\r\n                copyArray.splice(ind, 0, uploadedPostObj)\r\n                copyArray.sort((a, b) => this.sortFunc(a, b));\r\n                this.setState({\r\n                  postArray: [...copyArray]\r\n                });\r\n              }\r\n              ind++;\r\n            })\r\n          })\r\n          .then(() => this.setState({ loadingPastPosts: false }))\r\n          .catch((e) => console.log(e.name))\r\n      });\r\n  }\r\n  render() {\r\n    return (\r\n      /* Page Container*/\r\n      <div className=\"page-container\" >\r\n        <div className=\"wall-post-main\">\r\n          <div className=\"wall-new-post\">\r\n            <div className=\"wall-post-top\">\r\n              צור פרסום</div>\r\n            <div className=\"wall-post-tip\">\r\n              (לפתיחת חלונית אימוג'י של הדפדפן לחץ על מקש נקודה (./ץ) ועל מקש Windows יחדיו)</div>\r\n            <div className=\"wall-post-mid\">\r\n              <input\r\n                className=\"form-control\"\r\n                type=\"text\"\r\n                onBlur={this.setPost}\r\n                placeholder=\"כתוב פרסום..\"\r\n                value={this.state.textInput}\r\n                onChange={(e) => this.setState({ textInput: e.target.value })}\r\n              />\r\n            </div>\r\n            <div className=\"wall-post-footer\">\r\n              <button className=\"btn btn-success wall-post-b-a\" onClick={this.AddPic}>\r\n                צרף תמונה\r\n              </button>\r\n              <button className=\"btn btn-success wall-post-b-p\" onClick={this.addPost}>\r\n                פרסם\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"wall-post-list\">\r\n\r\n            {this.state.postArray.map((post, index) => {\r\n              return (\r\n                <Post\r\n                  myProfilePic={this.props.myProfilePic}\r\n                  friendProfilePic={this.props.friendProfilePic}\r\n                  userName={this.props.userName}\r\n                  friendName={this.props.friendName}\r\n                  key={\"post\" + index}\r\n                  id={post.id}\r\n                  body={post.body}\r\n                  img={post.img}\r\n                  doc_id={post.doc_id}\r\n                  timeStamp={post.timeStamp}\r\n                  uploader={post.uploader}\r\n                  delete={this.deleteEvent.bind(this, index, post.doc_id)}\r\n                  uploadProgress={this.state.uploadProgress}\r\n                  currId={this.state.currId}\r\n                />\r\n              );\r\n            }).reverse()}\r\n          </div>\r\n          <button className=\"btn btn-primary load-more-posts\" disabled={this.state.loadedAll} onClick={this.loadMorePosts}>טען פוסטים נוספים</button>\r\n          <Loader className=\"loader-past-posts\" type=\"TailSpin\" height=\"30px\" width=\"30px\" color=\"royalblue\" visible={this.state.loadingPastPosts}></Loader>\r\n        </div>\r\n        {this.state.showPicForm ? (\r\n          <AddPicture\r\n            parentCallback={this.callbackForm}\r\n            setImagePostParent={this.setImagePost}\r\n            setPicText={this.setPicText}\r\n            showText={true}\r\n          />\r\n        ) : null\r\n        }\r\n      </div >\r\n    );\r\n  }\r\n}\r\n\r\nexport default WallPost;"]},"metadata":{},"sourceType":"module"}